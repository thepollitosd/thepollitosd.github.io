<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orbital Overdrive</title>
    <link rel="icon" type="image/png" href="/public/favicon/favicon-96x96.png" sizes="96x96" />
	<link rel="icon" type="image/svg+xml" href="/public/favicon/favicon.svg" />
	<link rel="shortcut icon" href="/public/favicon/favicon.ico" />
	<link rel="apple-touch-icon" sizes="180x180" href="/public/favicon/apple-touch-icon.png" />
	<meta name="apple-mobile-web-app-title" content="Orbital Overdrive" />
    <link rel="manifest" href="/public/favicon/site.webmanifest" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Space+Grotesk:wght@300;500;700&display=swap');

        :root {
            --bg-light: #f8fafc;
            --text-main: #334155;
            --accent-blue: #3b82f6;
            --accent-shadow: rgba(59, 130, 246, 0.25);
        }

        *, *::before, *::after {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg-light);
            color: var(--text-main);
            font-family: 'Outfit', sans-serif;
            overflow-x: hidden;
            height: 100vh;
            background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .font-mono-display { font-family: 'Space Grotesk', monospace; }

        /* Scrollbar styling for panels */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .ptable-wrapper {
            width: 100%;
            height: 100%;
            overflow: auto;
            padding: 1rem;
            display: flex;
            justify-content: flex-start;
            align-items: flex-start;
        }

        @media (min-width: 1024px) {
            .ptable-wrapper { justify-content: center; align-items: center; }
        }

        .ptable {
            display: grid;
            grid-template-columns: repeat(18, minmax(30px, 42px)); 
            grid-template-rows: repeat(5, minmax(30px, 42px));
            gap: 3px;
            margin: auto;
        }

        .element {
            aspect-ratio: 1/1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid transparent;
            font-weight: 600;
            position: relative;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .element span.symbol { font-size: 1.2em; line-height: 1; font-weight: 800; }
        .element span.number { font-size: 0.6em; opacity: 0.6; position: absolute; top: 1px; left: 2px; }

        .element:hover { transform: scale(1.35); z-index: 50; box-shadow: 0 10px 20px rgba(0,0,0,0.15); border-color: white; }
        
        .element.target-highlight { 
            transform: scale(1.2); z-index: 40; 
            box-shadow: 0 0 0 3px var(--accent-blue);
            background-color: white !important;
            border-color: var(--accent-blue);
        }

        .mode-identify .element:hover {
            border-color: var(--accent-blue);
            cursor: crosshair;
        }

        .block-s { background-color: #fee2e2; color: #dc2626; border-color: #fecaca; }
        .block-p { background-color: #dbeafe; color: #2563eb; border-color: #bfdbfe; }
        .block-d { background-color: #fef3c7; color: #d97706; border-color: #fde68a; }

        .orbital-box {
            width: 32px; height: 32px; border: 2px solid #cbd5e1; border-radius: 6px;
            display: inline-flex; justify-content: center; align-items: center; margin: 1px;
            background: white; transition: all 0.1s; cursor: pointer;
        }
        @media (min-width: 640px) {
            .orbital-box { width: 38px; height: 38px; }
        }
        .orbital-box:hover { border-color: var(--accent-blue); background: #eff6ff; }
        .spin-arrow { font-size: 20px; font-weight: 800; line-height: 1; }

        .config-block {
            padding: 4px 10px; background: white; border: 2px solid #e2e8f0; border-radius: 8px;
            margin: 2px; cursor: pointer; position: relative;
            display: inline-flex; flex-direction: column; align-items: center;
        }
        .config-super { 
            font-size: 0.7rem; background: #eff6ff; color: #2563eb; padding: 0 4px; border-radius: 4px; 
            position: absolute; top: -6px; right: -6px; font-weight: bold; border: 1px solid #dbeafe;
        }

        .shake { animation: shake 0.4s ease-in-out; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-6px); } 75% { transform: translateX(6px); } }
        
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .key-btn {
            background: white; border: 1px solid #e2e8f0; border-bottom-width: 3px; border-radius: 0.5rem;
            font-family: 'Space Grotesk', monospace; font-weight: 600; color: #475569;
            display: flex; align-items: center; justify-content: center; min-height: 42px;
            transition: all 0.1s;
            cursor: pointer;
        }
        .key-btn:active { transform: translateY(2px); border-bottom-width: 1px; }
        .key-noble { background: #eff6ff; color: #2563eb; border-color: #bfdbfe; }

        #toast { transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.4s ease; }
        .toast-visible { transform: translate(-50%, 0) !important; opacity: 1 !important; }
        .toast-hidden { transform: translate(-50%, -150%) !important; opacity: 0 !important; }

        .cursor-blink {
            display: inline-block;
            width: 2px;
            height: 1.2em;
            background: var(--accent-blue);
            margin-left: 2px;
            animation: blink 1s infinite;
            vertical-align: middle;
        }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        .diagram-scroll-container {
            width: 100%;
            overflow-x: auto;
            padding: 10px 0;
            display: flex;
            justify-content: center;
        }

        /* Dashboard Styles */
        #dashboard {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(248, 250, 252, 0.98);
            backdrop-filter: blur(8px);
            z-index: 100;
        }
        .mode-card {
            background: white; border: 1px solid #e2e8f0; border-radius: 12px;
            padding: 1rem; cursor: pointer; transition: all 0.2s;
            display: flex; flex-direction: column; align-items: center; gap: 0.5rem;
            text-align: center;
        }
        .mode-card:hover {
            transform: translateY(-4px); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);
            border-color: var(--accent-blue);
        }
        .mode-icon { font-size: 2rem; }
        
        #timer-bar-container {
            width: 100%; height: 4px; background: #e2e8f0; position: absolute; bottom: 0; left: 0;
        }
        #timer-bar {
            height: 100%; background: var(--accent-blue); width: 100%; transition: width 1s linear;
        }

        /* Nav Tab Active State */
        .dash-nav-btn { position: relative; color: #94a3b8; transition: color 0.2s; padding: 0.5rem 1rem; }
        .dash-nav-btn.active { color: #2563eb; }
        .dash-nav-btn.active::after {
            content: ''; position: absolute; bottom: 4px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; background: #2563eb; border-radius: 50%;
        }
        .dash-section { display: none; animation: fadeIn 0.3s ease-out; }
        .dash-section.active { display: flex; }
        
        /* Version History Styles */
        .version-block { margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid #e2e8f0; }
        .version-block:last-child { border-bottom: none; }
        .v-tag { font-family: 'Space Grotesk', monospace; font-weight: bold; font-size: 0.9rem; color: #334155; }
        .v-name { font-size: 0.7rem; font-weight: bold; text-transform: uppercase; letter-spacing: 0.05em; color: #94a3b8; }
        .v-list { margin-top: 0.5rem; padding-left: 1rem; list-style-type: disc; font-size: 0.8rem; color: #64748b; line-height: 1.4; }
    </style>
</head>
<body class="p-2 md:p-4 h-screen flex flex-col" oncontextmenu="return false;">

    <!-- DASHBOARD OVERLAY -->
    <div id="dashboard" class="p-4 flex flex-col justify-center items-center">
        
        <!-- Header -->
        <div class="text-center w-full flex-none mb-4 md:mb-6 mt-4">
            <div class="inline-block w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center text-white font-bold text-2xl shadow-lg shadow-blue-200 mb-2">O</div>
            <h1 class="text-3xl font-black text-slate-800 tracking-tighter">ORBITAL <span class="text-blue-600">OVERDRIVE</span></h1>
        </div>

        <!-- Content Containers -->
        <div class="w-full max-w-4xl flex-grow flex flex-col items-center pb-24 overflow-y-auto custom-scroll relative z-10 px-2">
            
            <!-- HOME: Game Modes -->
            <div id="dash-home" class="dash-section active w-full flex-col items-center">
                <p class="text-slate-400 font-bold tracking-widest text-xs uppercase mb-6">Select Simulation Protocol</p>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 w-full max-w-2xl mb-8">
                    <button onclick="startGame('Classic')" class="mode-card group">
                        <span class="mode-icon group-hover:scale-110 transition-transform">üé≤</span>
                        <span class="font-bold text-slate-700">Classic</span>
                        <span class="text-[10px] text-slate-400">Mixed curriculum</span>
                    </button>
                    <button onclick="startGame('Architect')" class="mode-card group">
                        <span class="mode-icon group-hover:scale-110 transition-transform">üèóÔ∏è</span>
                        <span class="font-bold text-slate-700">Architect</span>
                        <span class="text-[10px] text-slate-400">Electron Configs</span>
                    </button>
                    <button onclick="startGame('Quantum')" class="mode-card group">
                        <span class="mode-icon group-hover:scale-110 transition-transform">üì¶</span>
                        <span class="font-bold text-slate-700">Quantum</span>
                        <span class="text-[10px] text-slate-400">Orbital Diagrams</span>
                    </button>
                    <button onclick="startGame('Detective')" class="mode-card group">
                        <span class="mode-icon group-hover:scale-110 transition-transform">üîç</span>
                        <span class="font-bold text-slate-700">Detective</span>
                        <span class="text-[10px] text-slate-400">Identify Elements</span>
                    </button>
                    <button onclick="startGame('Nuclear')" class="mode-card group">
                        <span class="mode-icon group-hover:scale-110 transition-transform">‚öõÔ∏è</span>
                        <span class="font-bold text-slate-700">Nuclear</span>
                        <span class="text-[10px] text-slate-400">p+, n0, e- & Isotopes</span>
                    </button>
                    <button onclick="startGame('Metric')" class="mode-card group">
                        <span class="mode-icon group-hover:scale-110 transition-transform">üìè</span>
                        <span class="font-bold text-slate-700">Metric Master</span>
                        <span class="text-[10px] text-slate-400">Conversions</span>
                    </button>
                    <button onclick="startGame('SciNot')" class="mode-card group">
                        <span class="mode-icon group-hover:scale-110 transition-transform">üî¨</span>
                        <span class="font-bold text-slate-700">Sci-Not</span>
                        <span class="text-[10px] text-slate-400">Scientific Notation</span>
                    </button>
                    <button onclick="startGame('SigFig')" class="mode-card group">
                        <span class="mode-icon group-hover:scale-110 transition-transform">üìê</span>
                        <span class="font-bold text-slate-700">Sig Figs</span>
                        <span class="text-[10px] text-slate-400">Ops & Counting</span>
                    </button>
                    <button onclick="startGame('Trends')" class="mode-card group">
                        <span class="mode-icon group-hover:scale-110 transition-transform">üìà</span>
                        <span class="font-bold text-slate-700">Trends</span>
                        <span class="text-[10px] text-slate-400">Face-off Mode</span>
                    </button>
                    <button onclick="startGame('Trivia')" class="mode-card group">
                        <span class="mode-icon group-hover:scale-110 transition-transform">üß†</span>
                        <span class="font-bold text-slate-700">Trivia</span>
                        <span class="text-[10px] text-slate-400">Vocabulary</span>
                    </button>
                </div>

                <!-- Settings -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 w-full max-w-md">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">Training Parameters</h3>
                    
                    <!-- Timer -->
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm font-bold text-slate-700">Time Limit</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="timer-toggle" class="sr-only peer" onchange="toggleTimerSettings()">
                            <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    <div id="timer-duration-setting" class="flex items-center justify-between opacity-50 pointer-events-none transition-opacity mb-6">
                        <span class="text-sm font-bold text-slate-400 ml-4">Duration</span>
                        <div class="flex gap-2">
                            <button onclick="setTimerDuration(15)" class="t-btn px-3 py-1 rounded border border-slate-200 text-xs font-bold bg-slate-50 hover:bg-white active:bg-blue-50" id="t-15">15s</button>
                            <button onclick="setTimerDuration(30)" class="t-btn px-3 py-1 rounded border border-slate-200 text-xs font-bold bg-slate-50 hover:bg-white active:bg-blue-50" id="t-30">30s</button>
                            <button onclick="setTimerDuration(60)" class="t-btn px-3 py-1 rounded border border-slate-200 text-xs font-bold bg-slate-50 hover:bg-white active:bg-blue-50" id="t-60">60s</button>
                        </div>
                    </div>

                    <!-- Focus Range -->
                    <div class="flex items-center justify-between mb-6">
                        <span class="text-sm font-bold text-slate-700">Focus Range</span>
                        <div class="flex gap-1">
                            <button onclick="setFocusRange(3)" class="range-btn px-2 py-1 rounded border border-slate-200 text-[10px] font-bold bg-slate-50 hover:bg-white" id="range-3">P 1-3</button>
                            <button onclick="setFocusRange(4)" class="range-btn px-2 py-1 rounded border border-slate-200 text-[10px] font-bold bg-slate-50 hover:bg-white" id="range-4">P 1-4</button>
                            <button onclick="setFocusRange(5)" class="range-btn px-2 py-1 rounded border border-slate-200 text-[10px] font-bold bg-blue-600 text-white border-blue-600" id="range-5">ALL</button>
                        </div>
                    </div>

                    <!-- Difficulty -->
                    <div class="flex flex-col gap-2">
                        <span class="text-sm font-bold text-slate-700">Difficulty Level</span>
                        <div class="flex gap-2 w-full">
                            <button onclick="setDifficulty('normal')" id="diff-normal" class="flex-1 py-2 rounded-lg border border-purple-600 bg-purple-600 text-white font-bold text-xs transition-colors">Normal</button>
                            <button onclick="setDifficulty('pro')" id="diff-pro" class="flex-1 py-2 rounded-lg border border-slate-200 bg-slate-50 text-slate-500 font-bold text-xs hover:bg-white transition-colors">Pro</button>
                            <button onclick="setDifficulty('ultra')" id="diff-ultra" class="flex-1 py-2 rounded-lg border border-slate-200 bg-slate-50 text-slate-500 font-bold text-xs hover:bg-white transition-colors">Ultra</button>
                        </div>
                        <p id="diff-desc" class="text-[10px] text-slate-400 mt-1 h-4">Standard experience with all hints enabled.</p>
                    </div>

                </div>
            </div>

            <!-- REFERENCE -->
            <div id="dash-reference" class="dash-section w-full max-w-2xl flex-col gap-6">
                <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200">
                    <h2 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                        <span class="text-2xl">üìñ</span> Chemist's Handbook
                    </h2>
                    
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-blue-600 font-bold text-sm uppercase tracking-wide mb-2">Metric Prefixes</h3>
                            <ul class="grid grid-cols-2 gap-2 text-sm text-slate-600">
                                <li class="bg-slate-50 p-2 rounded border border-slate-100">Kilo (k) = 1,000</li>
                                <li class="bg-slate-50 p-2 rounded border border-slate-100">Centi (c) = 0.01</li>
                                <li class="bg-slate-50 p-2 rounded border border-slate-100">Milli (m) = 0.001</li>
                                <li class="bg-slate-50 p-2 rounded border border-slate-100">Micro (¬µ) = 10‚Åª‚Å∂</li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="text-blue-600 font-bold text-sm uppercase tracking-wide mb-2">Sig Figs Rules</h3>
                            <ul class="space-y-2 text-sm text-slate-600">
                                <li class="bg-slate-50 p-3 rounded-lg border border-slate-100">
                                    <strong class="text-slate-800">Add/Sub:</strong> Round to least number of <em class="text-blue-600">decimal places</em>.
                                </li>
                                <li class="bg-slate-50 p-3 rounded-lg border border-slate-100">
                                    <strong class="text-slate-800">Mult/Div:</strong> Round to least number of <em class="text-blue-600">sig figs</em>.
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h3 class="text-blue-600 font-bold text-sm uppercase tracking-wide mb-2">Subatomic Particles</h3>
                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-100 text-sm text-slate-600 space-y-2">
                                <p><strong class="text-slate-800">Protons:</strong> Equal to Atomic Number (Z).</p>
                                <p><strong class="text-slate-800">Neutrons:</strong> Mass Number - Protons.</p>
                                <p><strong class="text-slate-800">Electrons:</strong> Protons - Charge.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ABOUT -->
            <div id="dash-about" class="dash-section w-full max-w-2xl flex-col gap-6">
                <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200">
                    <h2 class="text-2xl font-bold text-slate-800 mb-4">About the Simulation</h2>
                    <p class="text-slate-600 mb-4 leading-relaxed">
                        Orbital Overdrive is an interactive training module designed for Honors Chemistry students.
                    </p>
                    <div class="p-4 bg-slate-50 rounded-xl border border-slate-100">
                        <h3 class="font-bold text-slate-700 mb-2 text-sm">Modules</h3>
                        <ul class="list-disc list-inside text-sm text-slate-500 space-y-1">
                            <li>Electron Configurations (Aufbau)</li>
                            <li>Orbital Diagrams (Hund/Pauli)</li>
                            <li>Periodic Trends (Radius, IE, EN, Affinity)</li>
                            <li>Nuclear Chemistry (Isotopes, Ions, Particles)</li>
                            <li>Measurement (Sig Fig Counting & Operations)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- HISTORY -->
            <div id="dash-history" class="dash-section w-full max-w-2xl flex-col gap-4">
                
                <!-- v1.8 -->
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1 h-full bg-blue-500"></div>
                    <div class="flex justify-between items-baseline mb-2">
                        <h3 class="text-lg font-bold text-slate-800">v1.8 <span class="text-blue-500">b.2</span></h3>
                        <span class="text-xs font-bold bg-blue-100 text-blue-600 px-2 py-1 rounded">CURRENT</span>
                    </div>
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">METRIC STORM</p>
                    <ul class="text-sm text-slate-600 space-y-1 list-disc list-inside">
                        <li>Fixed: Full element list (1-54) restored to prevent missing grid cells</li>
                        <li>Added Study Guide Vocab: Precision, Accuracy, Density</li>
                        <li>Added Study Guide Vocab: Physical vs Chemical Changes</li>
                        <li>Expanded Reference Library with new vocab and rules</li>
                    </ul>
                </div>

                <!-- v1.7 -->
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200 opacity-90">
                    <h3 class="text-lg font-bold text-slate-800 mb-1">v1.7 <span class="text-slate-400">b.1</span></h3>
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">FINAL EXAM</p>
                    <ul class="text-sm text-slate-600 space-y-1 list-disc list-inside">
                        <li>New Mode: Sig Fig Master</li>
                        <li>New Mode: Trends Face-off (Radius, IE, EN)</li>
                        <li>Expanded Nuclear mode: Protons/Electrons/Ions</li>
                    </ul>
                </div>

                <!-- v1.6 -->
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200 opacity-80">
                    <h3 class="text-lg font-bold text-slate-800 mb-1">v1.6 <span class="text-slate-400">b.1</span></h3>
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">ISOTOPIC INFINITY</p>
                    <ul class="text-sm text-slate-600 space-y-1 list-disc list-inside">
                        <li>New Reference Tab (Chemist's Handbook)</li>
                        <li>Mobile-optimized Dashboard navigation</li>
                    </ul>
                </div>

                <!-- v1.5 -->
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200 opacity-70">
                    <h3 class="text-lg font-bold text-slate-800 mb-1">v1.5 <span class="text-slate-400">b.1</span></h3>
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">ULTRA VIOLET</p>
                    <ul class="text-sm text-slate-600 space-y-1 list-disc list-inside">
                        <li>New Difficulty System: Normal, Pro, Ultra</li>
                        <li>Ultra Mode: Hides Atomic Numbers</li>
                    </ul>
                </div>

                <!-- v1.4 -->
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200 opacity-60">
                    <h3 class="text-lg font-bold text-slate-800 mb-1">v1.4 <span class="text-slate-400">b.1</span></h3>
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">QUANTUM TUNING</p>
                    <ul class="text-sm text-slate-600 space-y-1 list-disc list-inside">
                        <li>New "Focus Range" setting (P 1-3, 1-4, All)</li>
                        <li>Initial Pro Mode implementation</li>
                    </ul>
                </div>
            </div>

            <!-- DEV NOTES -->
            <div id="dash-dev" class="dash-section w-full max-w-2xl flex-col gap-6">
                <div class="bg-slate-900 p-8 rounded-3xl shadow-lg border border-slate-800 text-slate-300 font-mono text-sm leading-relaxed">
                    <h2 class="text-xl font-bold text-white mb-4">// DEVELOPER LOG</h2>
                    <div class="mb-6">
                        <h3 class="text-blue-400 font-bold mb-2">> TECH_STACK</h3>
                        <p>Vanilla HTML5/JS + TailwindCSS.</p>
                    </div>
                    <div>
                        <h3 class="text-blue-400 font-bold mb-2">> LOGIC UPDATE v1.8</h3>
                        <p>Implemented dynamic Metric Conversion generator. Factors powers of 10 for basic units (m, L, g). Added scientific notation parsing logic.</p>
                    </div>
                </div>
            </div>

        </div>

        <!-- Dashboard Nav (Fixed Bottom Bar) -->
        <div class="fixed bottom-0 left-0 w-full bg-white/90 backdrop-blur border-t border-slate-200 p-2 flex justify-around md:justify-center md:gap-12 z-50 shadow-lg">
            <button onclick="switchDash('home')" id="nav-home" class="dash-nav-btn active font-bold uppercase tracking-widest text-[10px] md:text-xs">Play</button>
            <button onclick="switchDash('reference')" id="nav-reference" class="dash-nav-btn font-bold uppercase tracking-widest text-[10px] md:text-xs">Ref</button>
            <button onclick="switchDash('about')" id="nav-about" class="dash-nav-btn font-bold uppercase tracking-widest text-[10px] md:text-xs">About</button>
            <button onclick="switchDash('history')" id="nav-history" class="dash-nav-btn font-bold uppercase tracking-widest text-[10px] md:text-xs">History</button>
            <button onclick="switchDash('dev')" id="nav-dev" class="dash-nav-btn font-bold uppercase tracking-widest text-[10px] md:text-xs">Dev</button>
        </div>
    </div>

    <!-- MAIN GAME UI (Hidden by Dashboard initially) -->
    <nav class="flex-none flex flex-col md:flex-row justify-between items-center bg-white p-3 md:p-4 rounded-xl shadow-sm border border-slate-200 mb-2 mx-auto w-full max-w-[1400px] gap-2">
        <div class="flex items-center gap-3">
            <button onclick="showDashboard()" class="p-2 rounded-lg hover:bg-slate-100 text-slate-400 hover:text-slate-600 transition-colors" title="Back to Menu">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
            <div class="leading-tight cursor-pointer" onclick="showDashboard()">
                <h1 class="text-xl font-bold tracking-tight text-slate-800">ORBITAL <span class="text-blue-600">OVERDRIVE</span></h1>
                <p class="text-[10px] text-slate-400 font-bold uppercase tracking-wider">Honors Chemistry</p>
            </div>
        </div>
        
        <div class="flex gap-4 md:gap-8 text-center bg-slate-50 p-2 rounded-lg border border-slate-100">
            <div>
                <p class="text-[10px] text-slate-400 font-bold uppercase">Streak</p>
                <p id="streak-val" class="text-lg font-mono-display font-bold text-orange-500">0</p>
            </div>
            <div>
                <p class="text-[10px] text-slate-400 font-bold uppercase">Score</p>
                <p id="score-val" class="text-lg font-mono-display font-bold text-emerald-500">0</p>
            </div>
            <div>
                <p class="text-[10px] text-slate-400 font-bold uppercase">Level</p>
                <p id="level-val" class="text-lg font-mono-display font-bold text-blue-500">1</p>
            </div>
        </div>
    </nav>

    <div class="flex-grow grid grid-cols-1 lg:grid-cols-12 gap-2 md:gap-4 max-w-[1400px] mx-auto w-full overflow-hidden">
        
        <!-- PERIODIC TABLE AREA -->
        <div class="lg:col-span-7 bg-white rounded-2xl shadow-md border border-slate-100 flex flex-col order-2 lg:order-1 relative h-full overflow-hidden">
            <div class="flex-none flex justify-between items-end p-3 pb-0">
                <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest">Periodic Table</h3>
                <div id="table-instruction" class="text-xs font-bold text-blue-500 bg-blue-50 px-2 py-1 rounded hidden animate-pulse">Select Element</div>
            </div>
            
            <div class="ptable-wrapper">
                <div id="ptable-container" class="ptable"></div>
            </div>
        </div>

        <!-- INTERACTION SIDEBAR -->
        <div class="lg:col-span-5 flex flex-col gap-2 md:gap-4 order-1 lg:order-2 h-full overflow-y-auto pb-4">
            
            <div id="prompt-card" class="bg-white p-4 md:p-6 rounded-2xl shadow-lg border border-blue-50 text-center relative overflow-hidden min-h-[160px] flex flex-col justify-center items-center transition-all flex-none">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500"></div>
                <div id="timer-bar-container" class="hidden">
                    <div id="timer-bar"></div>
                </div>
                
                <div class="absolute top-3 left-0 w-full flex justify-between px-4 items-center">
                    <span id="prompt-label" class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Target</span>
                    <div id="mode-badge" class="flex items-center gap-2 bg-slate-100 px-3 py-1.5 rounded-lg text-sm font-bold text-slate-700 shadow-sm border border-slate-200">
                        <div class="w-2.5 h-2.5 rounded-full bg-blue-500"></div> Standard
                    </div>
                </div>

                <div id="prompt-content" class="w-full mt-6"></div>
            </div>

            <!-- SUCCESS PANEL -->
            <div id="info-panel" class="hidden bg-emerald-50 border border-emerald-100 p-4 rounded-xl fade-in flex-none">
                <div class="flex gap-3">
                    <div class="text-2xl">üí°</div>
                    <div class="flex-grow">
                        <h4 class="text-sm font-bold text-emerald-800" id="info-title">Fact</h4>
                        <p class="text-xs text-emerald-700 mt-1 leading-relaxed" id="info-desc">...</p>
                        <button onclick="nextLevel()" class="w-full mt-3 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 rounded-lg text-sm shadow-sm transition-colors">
                            Next Challenge ‚Üí
                        </button>
                    </div>
                </div>
            </div>

            <!-- THE TYPING / INPUT WINDOW -->
            <div id="input-area" class="bg-white p-4 rounded-2xl shadow-md border border-slate-100 flex-grow flex flex-col relative transition-all min-h-[260px]">
                <div class="flex justify-between items-center mb-2">
                    <h4 class="text-xs font-bold text-slate-500 uppercase">Input Window</h4>
                    <button onclick="resetInput()" id="btn-reset" class="text-[10px] font-bold text-red-400 hover:text-red-500 uppercase hover:bg-red-50 px-2 py-1 rounded">Reset</button>
                </div>

                <!-- 1. Configuration Builder -->
                <div id="builder-ui" class="hidden flex-col gap-3 h-full">
                    <div id="config-output" class="min-h-[60px] bg-slate-50 border-2 border-slate-200 border-dashed rounded-xl p-3 flex flex-wrap gap-1 items-center content-center justify-center"></div>
                    <div class="grid grid-cols-5 gap-1.5" id="orbital-keypad"></div>
                </div>

                <!-- 2. Numeric Window -->
                <div id="numeric-ui" class="hidden flex-col gap-3 h-full">
                    <div class="flex justify-center mb-2">
                        <div class="bg-slate-50 border-2 border-slate-200 rounded-xl px-6 py-2 flex items-center min-w-[120px] justify-center">
                            <span id="numeric-display" class="text-4xl font-mono font-bold text-slate-800"></span>
                            <span class="cursor-blink"></span>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 flex-grow" id="numeric-keys"></div>
                </div>

                <!-- 3. Vocabulary Quiz Window -->
                <div id="quiz-ui" class="hidden flex-col gap-2 h-full justify-center"></div>

                <!-- 4. Orbital Diagram Window -->
                <div id="diagram-ui" class="hidden flex-col items-center">
                    <div class="diagram-scroll-container">
                         <div id="orbital-diagram-grid" class="flex flex-wrap gap-y-4 gap-x-2 justify-center max-w-full"></div>
                    </div>
                    <p id="diagram-hint" class="text-[10px] text-slate-400 mt-2 italic font-medium uppercase tracking-widest text-center">Click boxes to add/remove electrons</p>
                </div>

                <!-- 5. Trend/Faceoff Window -->
                <div id="trend-ui" class="hidden flex-row gap-4 h-full justify-center items-center"></div>

                <!-- Common Submit -->
                <div class="mt-auto pt-4" id="submit-wrapper">
                    <button id="submit-btn" class="w-full py-4 bg-slate-900 text-white rounded-xl font-bold tracking-wide hover:bg-slate-800 active:scale-95 transition-all shadow-lg flex items-center justify-center gap-2">
                        <span>CONFIRM ANSWER</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    </button>
                </div>
            </div>

            <!-- HUNT / IDENTIFY PROMPT -->
            <div id="identify-hint" class="hidden bg-slate-50 p-6 rounded-2xl border-2 border-dashed border-slate-200 text-center flex-col justify-center items-center h-full">
                <div class="text-4xl mb-2">üëÜ</div>
                <h3 class="text-slate-800 font-bold">Select on Table</h3>
                <p class="text-sm text-slate-500 mt-2" id="hunt-msg">Find the correct element to answer.</p>
            </div>
        </div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="fixed top-24 left-1/2 px-6 py-4 bg-white rounded-full shadow-2xl border border-slate-100 flex items-center gap-3 z-[60] pointer-events-none toast-hidden">
        <div id="toast-icon" class="w-8 h-8 rounded-full bg-green-100 text-green-600 flex items-center justify-center font-bold">‚úì</div>
        <div>
            <p id="toast-title" class="font-bold text-sm text-slate-800">Correct!</p>
            <p id="toast-msg" class="text-xs text-slate-500">Streak +1</p>
        </div>
    </div>

    <!-- VERSION FOOTER -->
    <div class="fixed bottom-16 md:bottom-1 right-2 text-[10px] font-mono text-slate-400 opacity-60 pointer-events-none select-none z-50">
        ORBITAL_OS <span class="font-bold">v1.8</span> <span class="text-blue-400">b.2</span> [METRIC STORM]
    </div>

    <script>
        // --- COMPLETE ELEMENTS LIST (1-54) ---
        // Fully populated list ensuring no gaps in the grid rendering
        const elements = [
            {z: 1, s: "H", n: "Hydrogen", b: "s", d: "Most abundant element in the universe.", v:1},
            {z: 2, s: "He", n: "Helium", b: "s", d: "Inert noble gas used in balloons.", v:2},
            {z: 3, s: "Li", n: "Lithium", b: "s", d: "Lightest metal, used in batteries.", v:1},
            {z: 4, s: "Be", n: "Beryllium", b: "s", d: "Lightweight aerospace metal.", v:2},
            {z: 5, s: "B", n: "Boron", b: "p", d: "Metalloid used in heat-resistant glass.", v:3},
            {z: 6, s: "C", n: "Carbon", b: "p", d: "Basis of organic life.", v:4},
            {z: 7, s: "N", n: "Nitrogen", b: "p", d: "78% of Earth's atmosphere.", v:5},
            {z: 8, s: "O", n: "Oxygen", b: "p", d: "Essential for respiration.", v:6},
            {z: 9, s: "F", n: "Fluorine", b: "p", d: "Most reactive element.", v:7},
            {z: 10, s: "Ne", n: "Neon", b: "p", d: "Noble gas that glows red-orange.", v:8},
            {z: 11, s: "Na", n: "Sodium", b: "s", d: "Explodes in water, forms salt.", v:1},
            {z: 12, s: "Mg", n: "Magnesium", b: "s", d: "Burns with bright white light.", v:2},
            {z: 13, s: "Al", n: "Aluminum", b: "p", d: "Most abundant metal in crust.", v:3},
            {z: 14, s: "Si", n: "Silicon", b: "p", d: "Foundation of computer chips.", v:4},
            {z: 15, s: "P", n: "Phosphorus", b: "p", d: "Essential for ATP and DNA.", v:5},
            {z: 16, s: "S", n: "Sulfur", b: "p", d: "Yellow solid, smells like rotten eggs.", v:6},
            {z: 17, s: "Cl", n: "Chlorine", b: "p", d: "Toxic gas used in pools.", v:7},
            {z: 18, s: "Ar", n: "Argon", b: "p", d: "3rd most abundant atmospheric gas.", v:8},
            {z: 19, s: "K", n: "Potassium", b: "s", d: "Vital nutrient for nerves.", v:1},
            {z: 20, s: "Ca", n: "Calcium", b: "s", d: "Essential for bones and teeth.", v:2},
            {z: 21, s: "Sc", n: "Scandium", b: "d", d: "Used in stadium lights.", v:null},
            {z: 22, s: "Ti", n: "Titanium", b: "d", d: "Strong as steel, light as aluminum.", v:null},
            {z: 23, s: "V", n: "Vanadium", b: "d", d: "Used to harden steel tools.", v:null},
            {z: 24, s: "Cr", n: "Chromium", b: "d", d: "Exception alert: [Ar] 4s1 3d5.", v:null},
            {z: 25, s: "Mn", n: "Manganese", b: "d", d: "Crucial for steel making.", v:null},
            {z: 26, s: "Fe", n: "Iron", b: "d", d: "Core of the Earth.", v:null},
            {z: 27, s: "Co", n: "Cobalt", b: "d", d: "Used in magnets and blue glass.", v:null},
            {z: 28, s: "Ni", n: "Nickel", b: "d", d: "Used in coins and batteries.", v:null},
            {z: 29, s: "Cu", n: "Copper", b: "d", d: "Exception alert: [Ar] 4s1 3d10.", v:null},
            {z: 30, s: "Zn", n: "Zinc", b: "d", d: "Galvanizes steel.", v:null},
            {z: 31, s: "Ga", n: "Gallium", b: "p", d: "Metal that melts in your hand.", v:3},
            {z: 32, s: "Ge", n: "Germanium", b: "p", d: "Semiconductor used in transistors.", v:4},
            {z: 33, s: "As", n: "Arsenic", b: "p", d: "Historically famous poison.", v:5},
            {z: 34, s: "Se", n: "Selenium", b: "p", d: "Photoconductive metalloid.", v:6},
            {z: 35, s: "Br", n: "Bromine", b: "p", d: "Red-brown liquid halogen.", v:7},
            {z: 36, s: "Kr", n: "Krypton", b: "p", d: "Inert gas used in flash bulbs.", v:8},
            {z: 37, s: "Rb", n: "Rubidium", b: "s", d: "Highly reactive alkali metal.", v:1},
            {z: 38, s: "Sr", n: "Strontium", b: "s", d: "Gives fireworks a red color.", v:2},
            {z: 39, s: "Y", n: "Yttrium", b: "d", d: "Used in LEDs and superconductors.", v:null},
            {z: 40, s: "Zr", n: "Zirconium", b: "d", d: "Used in nuclear reactors.", v:null},
            {z: 41, s: "Nb", n: "Niobium", b: "d", d: "Used in jet engines.", v:null},
            {z: 42, s: "Mo", n: "Molybdenum", b: "d", d: "Exception: [Kr] 5s1 4d5.", v:null},
            {z: 43, s: "Tc", n: "Technetium", b: "d", d: "First artificially produced element.", v:null},
            {z: 44, s: "Ru", n: "Ruthenium", b: "d", d: "Rare metal used in electronics.", v:null},
            {z: 45, s: "Rh", n: "Rhodium", b: "d", d: "Rarest non-radioactive metal.", v:null},
            {z: 46, s: "Pd", n: "Palladium", b: "d", d: "Exception: [Kr] 4d10.", v:null},
            {z: 47, s: "Ag", n: "Silver", b: "d", d: "Exception: [Kr] 5s1 4d10.", v:null},
            {z: 48, s: "Cd", n: "Cadmium", b: "d", d: "Toxic metal used in batteries.", v:null},
            {z: 49, s: "In", n: "Indium", b: "p", d: "Used in touchscreens.", v:3},
            {z: 50, s: "Sn", n: "Tin", b: "p", d: "Alloyed with copper to make bronze.", v:4},
            {z: 51, s: "Sb", n: "Antimony", b: "p", d: "Used in flame retardants.", v:5},
            {z: 52, s: "Te", n: "Tellurium", b: "p", d: "One of the rarest metalloids.", v:6},
            {z: 53, s: "I", n: "Iodine", b: "p", d: "Vital for hormone production.", v:7},
            {z: 54, s: "Xe", n: "Xenon", b: "p", d: "Noble gas used in ion thrusters.", v:8}
        ];

        const vocabBank = [
            // ==================================================================
            // 1. ORIGINAL & REVIEW GUIDE (Existing Code)
            // ==================================================================
            { q: "Closeness to the true value?", a: "Accuracy", opts: ["Accuracy", "Precision", "Estimation", "Error"] },
            { q: "Reproducibility of a measurement?", a: "Precision", opts: ["Accuracy", "Precision", "Significance", "Percent Error"] },
            { q: "Formula for Density?", a: "Mass / Volume", opts: ["Mass / Volume", "Volume / Mass", "Mass * Volume", "Area * Length"] },
            { q: "Which is a chemical change?", a: "Burning", opts: ["Burning", "Melting", "Boiling", "Cutting"] },
            { q: "Which is a physical change?", a: "Dissolving", opts: ["Dissolving", "Rusting", "Burning", "Rotting"] },
            { q: "Phase change solid to gas?", a: "Sublimation", opts: ["Sublimation", "Deposition", "Melting", "Freezing"] },
            { q: "Phase change gas to solid?", a: "Deposition", opts: ["Sublimation", "Deposition", "Condensation", "Evaporation"] },
            { q: "Sig Fig rule for addition?", a: "Decimal Places", opts: ["Decimal Places", "Sig Figs", "Largest Value", "No Rounding"] },
            { q: "Sig Fig rule for multiplication?", a: "Least Sig Figs", opts: ["Least Sig Figs", "Decimal Places", "Most Sig Figs", "Average"] },
            { q: "Base unit for mass in lab?", a: "Gram", opts: ["Gram", "Meter", "Liter", "Second"] },
            { q: "Prefix for 10^-3?", a: "Milli", opts: ["Milli", "Centi", "Kilo", "Micro"] },
            { q: "Prefix for 10^3?", a: "Kilo", opts: ["Kilo", "Mega", "Giga", "Deca"] },
            { q: "Positive ions are called...", a: "Cations", opts: ["Cations", "Anions", "Protons", "Neutrons"] },
            { q: "Negative ions are called...", a: "Anions", opts: ["Cations", "Anions", "Nuclei", "Isotopes"] },
            { q: "Horizontal rows are called...", a: "Periods", opts: ["Groups", "Periods", "Blocks", "Families"] },
            { q: "Vertical columns are called...", a: "Groups", opts: ["Periods", "Groups", "Shells", "Series"] },
            { q: "Electrons in the outermost shell?", a: "Valence", opts: ["Core", "Valence", "Inner", "Nuclear"] },
            { q: "Atoms with same p+ but different n0?", a: "Isotopes", opts: ["Isotopes", "Ions", "Allotropes", "Isomers"] },
            { q: "Most electronegative element?", a: "Fluorine", opts: ["Fluorine", "Francium", "Oxygen", "Chlorine"] },
            { q: "Rule: Max 2 e- with opp. spin.", a: "Pauli Exclusion", opts: ["Aufbau", "Pauli Exclusion", "Hund", "Octet"] },
        
            // ==================================================================
            // 2. TYPES OF CHANGES (Physical vs Chemical) - 25 Questions
            // ==================================================================
            { q: "Digesting food is a...", a: "Chemical Change", opts: ["Chemical Change", "Physical Change", "Phase Change", "Nuclear Change"] },
            { q: "Evaporating water is a...", a: "Physical Change", opts: ["Chemical Change", "Physical Change", "Decomposition", "Combustion"] },
            { q: "Burning wood is a...", a: "Chemical Change", opts: ["Chemical Change", "Physical Change", "Fusion", "Sublimation"] },
            { q: "Rusting iron is a...", a: "Chemical Change", opts: ["Chemical Change", "Physical Change", "Melting", "Alloying"] },
            { q: "Crushing a can is a...", a: "Physical Change", opts: ["Chemical Change", "Physical Change", "Reaction", "Oxidation"] },
            { q: "Dissolving salt in water is a...", a: "Physical Change", opts: ["Chemical Change", "Physical Change", "Precipitation", "Neutralization"] },
            { q: "Milk turning sour is a...", a: "Chemical Change", opts: ["Chemical Change", "Physical Change", "Dilution", "Filtration"] },
            { q: "Baking a cake is a...", a: "Chemical Change", opts: ["Chemical Change", "Physical Change", "Mixing", "Distillation"] },
            { q: "Breaking glass is a...", a: "Physical Change", opts: ["Chemical Change", "Physical Change", "Combustion", "Decay"] },
            { q: "Exploding fireworks is a...", a: "Chemical Change", opts: ["Chemical Change", "Physical Change", "Evaporation", "Filtration"] },
            { q: "Melting ice is a...", a: "Physical Change", opts: ["Chemical Change", "Physical Change", "Reaction", "Combustion"] },
            { q: "Rotting bananas is a...", a: "Chemical Change", opts: ["Chemical Change", "Physical Change", "Phase Change", "Erosion"] },
            { q: "Chopping vegetables is a...", a: "Physical Change", opts: ["Chemical Change", "Physical Change", "Fermentation", "Oxidation"] },
            { q: "Fermenting grapes is a...", a: "Chemical Change", opts: ["Chemical Change", "Physical Change", "Boiling", "Freezing"] },
            { q: "Boiling water is a...", a: "Physical Change", opts: ["Chemical Change", "Physical Change", "Combustion", "Corrosion"] },
            { q: "Photosynthesis is a...", a: "Chemical Change", opts: ["Chemical Change", "Physical Change", "Phase Change", "Distillation"] },
            { q: "Mixing sand and water is a...", a: "Physical Change", opts: ["Chemical Change", "Physical Change", "Solution", "Reaction"] },
            { q: "Shredding paper is a...", a: "Physical Change", opts: ["Chemical Change", "Physical Change", "Burn", "Decay"] },
            { q: "Lighting a match is a...", a: "Chemical Change", opts: ["Chemical Change", "Physical Change", "Friction", "Motion"] },
            { q: "Tarnishing silver is a...", a: "Chemical Change", opts: ["Chemical Change", "Physical Change", "Polishing", "Cleaning"] },
            { q: "Freezing juice is a...", a: "Physical Change", opts: ["Chemical Change", "Physical Change", "Reaction", "Cooking"] },
            { q: "Grinding coffee beans is a...", a: "Physical Change", opts: ["Chemical Change", "Physical Change", "Brewing", "Roasting"] },
            { q: "Cooking an egg is a...", a: "Chemical Change", opts: ["Chemical Change", "Physical Change", "Heating", "Warming"] },
            { q: "Sublimation of dry ice is a...", a: "Physical Change", opts: ["Chemical Change", "Physical Change", "Combustion", "Reaction"] },
            { q: "Combustion of gasoline is a...", a: "Chemical Change", opts: ["Chemical Change", "Physical Change", "Vaporization", "Distillation"] },
        
            // ==================================================================
            // 3. PROPERTIES (Periodic Table & Physical/Chemical) - 25 Questions
            // ==================================================================
            { q: "Property dependent on amount of matter?", a: "Extensive", opts: ["Extensive", "Intensive", "Chemical", "Nuclear"] },
            { q: "Property independent of amount of matter?", a: "Intensive", opts: ["Extensive", "Intensive", "Massive", "Volumetric"] },
            { q: "Is 'Flammability' physical or chemical?", a: "Chemical", opts: ["Physical", "Chemical", "Intensive", "Nuclear"] },
            { q: "Is 'Density' physical or chemical?", a: "Physical", opts: ["Physical", "Chemical", "Extensive", "Reactive"] },
            { q: "Is 'Boiling Point' physical or chemical?", a: "Physical", opts: ["Physical", "Chemical", "Atomic", "Nuclear"] },
            { q: "Is 'Reactivity with Acid' physical or chemical?", a: "Chemical", opts: ["Physical", "Chemical", "Intensive", "Extensive"] },
            { q: "Trend: Atomic Radius down a group?", a: "Increases", opts: ["Increases", "Decreases", "Stays Same", "Fluctuates"] },
            { q: "Trend: Atomic Radius across a period?", a: "Decreases", opts: ["Increases", "Decreases", "Stays Same", "Fluctuates"] },
            { q: "Trend: Ionization Energy across a period?", a: "Increases", opts: ["Increases", "Decreases", "Stays Same", "Zero"] },
            { q: "Trend: Electronegativity down a group?", a: "Decreases", opts: ["Increases", "Decreases", "Stays Same", "Doubles"] },
            { q: "Elements in Group 18 are...", a: "Noble Gases", opts: ["Noble Gases", "Halogens", "Alkali Metals", "Earth Metals"] },
            { q: "Elements in Group 1 are...", a: "Alkali Metals", opts: ["Alkali Metals", "Alkaline Earth", "Halogens", "Noble Gases"] },
            { q: "Elements in Group 2 are...", a: "Alkaline Earth", opts: ["Alkaline Earth", "Alkali Metals", "Transition", "Halogens"] },
            { q: "Elements in Group 17 are...", a: "Halogens", opts: ["Halogens", "Noble Gases", "Metals", "Actinides"] },
            { q: "Metals are typically...", a: "Conductive", opts: ["Conductive", "Brittle", "Gases", "Dull"] },
            { q: "Nonmetals are typically...", a: "Poor Conductors", opts: ["Good Conductors", "Poor Conductors", "Shiny", "Malleable"] },
            { q: "Metalloids are found along the...", a: "Staircase Line", opts: ["Staircase Line", "Bottom Row", "Left Side", "Top Row"] },
            { q: "Most reactive nonmetal group?", a: "Halogens", opts: ["Halogens", "Noble Gases", "Transition Metals", "Lanthanides"] },
            { q: "Least reactive group?", a: "Noble Gases", opts: ["Noble Gases", "Halogens", "Alkali Metals", "Actinides"] },
            { q: "Ability to be hammered into sheets?", a: "Malleability", opts: ["Malleability", "Ductility", "Viscosity", "Solubility"] },
            { q: "Ability to be drawn into wire?", a: "Ductility", opts: ["Malleability", "Ductility", "Conductivity", "Luster"] },
            { q: "Tendency to attract electrons?", a: "Electronegativity", opts: ["Electronegativity", "Ionization", "Shielding", "Radii"] },
            { q: "Energy to remove an electron?", a: "Ionization Energy", opts: ["Ionization Energy", "Electronegativity", "Kinetic Energy", "Potential Energy"] },
        
            // ==================================================================
            // 4. WAVE CALC & ENERGY (J, kJ, E=hf, c=Œªv) - 25 Questions
            // ==================================================================
            { q: "Symbol for wavelength?", a: "Lambda (Œª)", opts: ["Lambda (Œª)", "Nu (ŒΩ)", "C", "h"] },
            { q: "Symbol for frequency?", a: "Nu (ŒΩ)", opts: ["Lambda (Œª)", "Nu (ŒΩ)", "C", "E"] },
            { q: "Constant 'c' represents?", a: "Speed of Light", opts: ["Speed of Light", "Planck's Constant", "Energy", "Frequency"] },
            { q: "Value of Speed of Light (c)?", a: "3.00 x 10^8 m/s", opts: ["3.00 x 10^8 m/s", "6.626 x 10^-34", "9.8 m/s^2", "1.01 x 10^5"] },
            { q: "Value of Planck's Constant (h)?", a: "6.626 x 10^-34 J¬∑s", opts: ["6.626 x 10^-34 J¬∑s", "3.00 x 10^8", "6.02 x 10^23", "1.008"] },
            { q: "Relationship between Œª and ŒΩ?", a: "Inverse", opts: ["Inverse", "Direct", "Exponential", "None"] },
            { q: "Formula relating c, Œª, and ŒΩ?", a: "c = ŒªŒΩ", opts: ["c = ŒªŒΩ", "E = hŒΩ", "Œª = cŒΩ", "ŒΩ = cŒª"] },
            { q: "Formula for Energy using frequency?", a: "E = hŒΩ", opts: ["E = hŒΩ", "E = mc^2", "c = ŒªŒΩ", "E = ŒªŒΩ"] },
            { q: "Formula for Energy using wavelength?", a: "E = hc / Œª", opts: ["E = hc / Œª", "E = hŒª / c", "E = c / Œª", "E = hŒΩŒª"] },
            { q: "Standard unit for Energy?", a: "Joules (J)", opts: ["Joules (J)", "Hertz (Hz)", "Meters (m)", "Watts (W)"] },
            { q: "Standard unit for Frequency?", a: "Hertz (Hz)", opts: ["Hertz (Hz)", "Joules (J)", "Meters (m)", "Seconds (s)"] },
            { q: "Standard unit for Wavelength?", a: "Meters (m)", opts: ["Meters (m)", "Hertz (Hz)", "Joules (J)", "Nanos"] },
            { q: "1 kJ is equal to...", a: "1000 J", opts: ["1000 J", "100 J", "10 J", "0.001 J"] },
            { q: "To convert J to kJ, you...", a: "Divide by 1000", opts: ["Divide by 1000", "Multiply by 1000", "Add 1000", "Subtract 1000"] },
            { q: "High frequency means...", a: "High Energy", opts: ["High Energy", "Low Energy", "Long Wavelength", "Slow Speed"] },
            { q: "Long wavelength means...", a: "Low Frequency", opts: ["Low Frequency", "High Frequency", "High Energy", "Fast Speed"] },
            { q: "Visible light with highest energy?", a: "Violet", opts: ["Violet", "Red", "Green", "Yellow"] },
            { q: "Visible light with longest wavelength?", a: "Red", opts: ["Red", "Violet", "Blue", "Green"] },
            { q: "Calculate ŒΩ if c=3e8 and Œª=3e-7?", a: "1 x 10^15 Hz", opts: ["1 x 10^15 Hz", "1 x 10^14 Hz", "9 x 10^1", "3 x 10^15"] },
            { q: "Packet of light energy is a...", a: "Photon", opts: ["Photon", "Proton", "Electron", "Neutron"] },
            { q: "Nanometer (nm) is...", a: "10^-9 m", opts: ["10^-9 m", "10^-6 m", "10^-3 m", "10^9 m"] },
            { q: "As frequency increases, energy...", a: "Increases", opts: ["Increases", "Decreases", "Stays Same", "Stops"] },
            { q: "Distance between wave peaks?", a: "Wavelength", opts: ["Wavelength", "Frequency", "Amplitude", "Speed"] },
            { q: "Waves per second is...", a: "Frequency", opts: ["Frequency", "Wavelength", "Speed", "Period"] },
            { q: "Which has higher energy than visible?", a: "Gamma Rays", opts: ["Gamma Rays", "Radio Waves", "Microwaves", "Infrared"] },
        
            // ==================================================================
            // 5. HEAT TRANSFER (q=mcŒîT, Temp, Mass) - 25 Questions
            // ==================================================================
            { q: "Symbol for heat energy?", a: "q", opts: ["q", "m", "c", "T"] },
            { q: "Symbol for specific heat?", a: "c", opts: ["c", "q", "m", "T"] },
            { q: "Symbol for change in temp?", a: "ŒîT", opts: ["ŒîT", "Tf", "Ti", "K"] },
            { q: "Formula for heat transfer?", a: "q = mcŒîT", opts: ["q = mcŒîT", "q = m/cŒîT", "q = c/mŒîT", "q = mc"] },
            { q: "Unit for Specific Heat?", a: "J/g¬∞C", opts: ["J/g¬∞C", "J", "¬∞C", "g"] },
            { q: "To find Mass (m), arrange formula:", a: "m = q / (cŒîT)", opts: ["m = q / (cŒîT)", "m = qcŒîT", "m = cŒîT / q", "m = qŒîT / c"] },
            { q: "To find ŒîT, arrange formula:", a: "ŒîT = q / (mc)", opts: ["ŒîT = q / (mc)", "ŒîT = qmc", "ŒîT = m / qc", "ŒîT = c / qm"] },
            { q: "Calculating ŒîT requires:", a: "T_final - T_initial", opts: ["T_final - T_initial", "T_initial - T_final", "T_final + T_initial", "T_final / T_initial"] },
            { q: "If q is negative, the process is...", a: "Exothermic", opts: ["Exothermic", "Endothermic", "Isobaric", "Adiabatic"] },
            { q: "If q is positive, the process is...", a: "Endothermic", opts: ["Endothermic", "Exothermic", "Kinetic", "Potential"] },
            { q: "Specific heat of water (approx)?", a: "4.18 J/g¬∞C", opts: ["4.18 J/g¬∞C", "1.00 J/g¬∞C", "2.05 J/g¬∞C", "10.0 J/g¬∞C"] },
            { q: "System releases heat...", a: "Exothermic", opts: ["Exothermic", "Endothermic", "Cold", "Absorption"] },
            { q: "System absorbs heat...", a: "Endothermic", opts: ["Endothermic", "Exothermic", "Hot", "Release"] },
            { q: "Temperature measures...", a: "Avg Kinetic Energy", opts: ["Avg Kinetic Energy", "Total Energy", "Heat Flow", "Potential Energy"] },
            { q: "Heat flows from...", a: "Hot to Cold", opts: ["Hot to Cold", "Cold to Hot", "Low to High", "Solid to Liquid"] },
            { q: "Solve ŒîT: Tf=50, Ti=20", a: "30", opts: ["30", "-30", "70", "25"] },
            { q: "Solve ŒîT: Tf=10, Ti=80", a: "-70", opts: ["-70", "70", "90", "8"] },
            { q: "High specific heat means...", a: "Resists Temp Change", opts: ["Resists Temp Change", "Heats up Fast", "Cools down Fast", "Conducts well"] },
            { q: "Low specific heat means...", a: "Changes Temp Easily", opts: ["Changes Temp Easily", "Insulator", "Resists Heat", "Hard to Cool"] },
            { q: "In calorimetry, -q_metal = ?", a: "q_water", opts: ["q_water", "-q_water", "Mass", "Temp"] },
            { q: "Unit for q is usually...", a: "Joules", opts: ["Joules", "Grams", "Celsius", "Newtons"] },
            { q: "1 calorie is equal to...", a: "4.184 J", opts: ["4.184 J", "1 J", "1000 J", "10 J"] },
            { q: "Phase change diagram: Flat lines?", a: "Potential Energy Change", opts: ["Potential Energy Change", "Kinetic Energy Change", "Cooling", "Heating"] },
            { q: "Phase change diagram: Sloped lines?", a: "Kinetic Energy Change", opts: ["Kinetic Energy Change", "Potential Energy Change", "Melting", "Boiling"] },
            { q: "Calorimeter measures...", a: "Heat Transfer", opts: ["Heat Transfer", "Mass", "Density", "Pressure"] },
        
            // ==================================================================
            // 6. A-Z NOTATION (Protons, Neutrons, Electrons) - 25 Questions
            // ==================================================================
            { q: "The top number (A) represents...", a: "Mass Number", opts: ["Mass Number", "Atomic Number", "Charge", "Neutrons"] },
            { q: "The bottom number (Z) represents...", a: "Atomic Number", opts: ["Atomic Number", "Mass Number", "Electrons", "Isotope"] },
            { q: "Mass Number (A) equals...", a: "Protons + Neutrons", opts: ["Protons + Neutrons", "Protons + Electrons", "Neutrons Only", "Protons Only"] },
            { q: "Atomic Number (Z) equals...", a: "Protons", opts: ["Protons", "Neutrons", "Mass", "A - Z"] },
            { q: "Neutrons are calculated by...", a: "A - Z", opts: ["A - Z", "A + Z", "Z - A", "Z * 2"] },
            { q: "In neutral atoms, electrons equal...", a: "Protons", opts: ["Protons", "Neutrons", "Mass Number", "Zero"] },
            { q: "Charge is calculated by...", a: "Protons - Electrons", opts: ["Protons - Electrons", "Electrons - Protons", "Neutrons + Protons", "Mass - Number"] },
            { q: "If Carbon-14 has Z=6, Neutrons?", a: "8", opts: ["8", "6", "14", "20"] },
            { q: "If Uranium-238 has Z=92, Neutrons?", a: "146", opts: ["146", "92", "238", "330"] },
            { q: "Proton location?", a: "Nucleus", opts: ["Nucleus", "Orbital", "Shell", "Cloud"] },
            { q: "Electron location?", a: "Electron Cloud", opts: ["Electron Cloud", "Nucleus", "Center", "Proton"] },
            { q: "Neutron location?", a: "Nucleus", opts: ["Nucleus", "Orbital", "Valence", "Outside"] },
            { q: "Proton charge?", a: "+1", opts: ["+1", "-1", "0", "+2"] },
            { q: "Neutron charge?", a: "0", opts: ["0", "+1", "-1", "+2"] },
            { q: "Electron charge?", a: "-1", opts: ["-1", "+1", "0", "-2"] },
            { q: "Mass of Proton (amu)?", a: "1", opts: ["1", "0", "1/1840", "2"] },
            { q: "Mass of Electron (amu)?", a: "Negligible (~0)", opts: ["Negligible (~0)", "1", "2", "4"] },
            { q: "Identity of element determined by...", a: "Protons", opts: ["Protons", "Neutrons", "Electrons", "Mass"] },
            { q: "Symbol for Proton?", a: "p+", opts: ["p+", "e-", "n0", "He"] },
            { q: "Symbol for Neutron?", a: "n0", opts: ["n0", "p+", "e-", "N"] },
            { q: "Symbol for Electron?", a: "e-", opts: ["e-", "p+", "n0", "E"] },
            { q: "An atom with charge -2 has...", a: "Gained 2 e-", opts: ["Gained 2 e-", "Lost 2 e-", "Lost 2 p+", "Gained 2 p+"] },
            { q: "An atom with charge +3 has...", a: "Lost 3 e-", opts: ["Lost 3 e-", "Gained 3 e-", "Gained 3 p+", "Lost 3 n0"] },
            { q: "Isotope notation 14_C: 14 is...", a: "Mass Number", opts: ["Mass Number", "Atomic Number", "Neutrons", "Electrons"] },
            { q: "Nuclear Force holds together...", a: "Protons & Neutrons", opts: ["Protons & Neutrons", "Electrons & Protons", "Electrons", "Ions"] },
        
            // ==================================================================
            // 7. AVERAGE ATOMIC MASS CALCULATION - 25 Questions
            // ==================================================================
            { q: "Formula for Avg Atomic Mass?", a: "Œ£ (Mass x Abundance)", opts: ["Œ£ (Mass x Abundance)", "(Mass + Mass)/2", "Mass x %", "Total Mass"] },
            { q: "Abundance must be converted to...", a: "Decimal", opts: ["Decimal", "Percentage", "Whole Number", "Fraction"] },
            { q: "To convert % to decimal...", a: "Divide by 100", opts: ["Divide by 100", "Multiply by 100", "Add 100", "Subtract 100"] },
            { q: "Unit for atomic mass?", a: "amu", opts: ["amu", "grams", "kg", "mols"] },
            { q: "Atomic mass on periodic table is...", a: "Weighted Average", opts: ["Weighted Average", "Mass of most common", "Mass of heaviest", "Integer"] },
            { q: "Cl-35 (75%) & Cl-37 (25%). Avg?", a: "35.5", opts: ["35.5", "36.0", "35.0", "37.0"] },
            { q: "B-10 (20%) & B-11 (80%). Avg?", a: "10.8", opts: ["10.8", "10.5", "11.0", "10.2"] },
            { q: "Mg-24 (80%), Mg-25 (10%), Mg-26 (10%)", a: "24.3", opts: ["24.3", "25.0", "24.0", "26.0"] },
            { q: "Isotopes affect an element's...", a: "Average Mass", opts: ["Average Mass", "Atomic Number", "Charge", "Chemical Properties"] },
            { q: "Most common isotope of C (12.01)?", a: "C-12", opts: ["C-12", "C-13", "C-14", "C-11"] },
            { q: "Most common isotope of H (1.008)?", a: "H-1", opts: ["H-1", "H-2", "H-3", "H-0"] },
            { q: "Percent abundances must sum to...", a: "100%", opts: ["100%", "50%", "1.0", "10%"] },
            { q: "Decimal abundances must sum to...", a: "1.0", opts: ["1.0", "100", "10", "0.1"] },
            { q: "Mass Spectrometry measures...", a: "Isotope Masses", opts: ["Isotope Masses", "Color", "Density", "Volume"] },
            { q: "Calc: 50% X-10, 50% X-12?", a: "11.0", opts: ["11.0", "10.5", "12.0", "10.0"] },
            { q: "Calc: 90% Y-20, 10% Y-22?", a: "20.2", opts: ["20.2", "21.0", "20.0", "22.0"] },
            { q: "Calc: 95% Z-14, 5% Z-15?", a: "14.05", opts: ["14.05", "14.5", "14.95", "15.0"] },
            { q: "Avg Mass is usually NOT a...", a: "Whole Number", opts: ["Whole Number", "Decimal", "Value", "Measurement"] },
            { q: "Cu-63 is 69%, Cu-65 is 31%.", a: "63.62", opts: ["63.62", "64.00", "63.00", "65.00"] },
            { q: "Why is mass not a whole number?", a: "Isotopes exist", opts: ["Isotopes exist", "Electron mass", "Proton variation", "Errors"] },
            { q: "If Avg Mass is near isotope A...", a: "A is abundant", opts: ["A is abundant", "A is rare", "A is heavy", "A is light"] },
            { q: "Relative abundance means...", a: "Percentage found", opts: ["Percentage found", "Weight", "Size", "Reactivity"] },
            { q: "Symbol for Atomic Mass Unit?", a: "u or amu", opts: ["u or amu", "g", "kg", "mol"] },
            { q: "Standard for amu is based on...", a: "Carbon-12", opts: ["Carbon-12", "Hydrogen-1", "Oxygen-16", "Helium-4"] },
            { q: "1 amu is defined as...", a: "1/12 mass of C-12", opts: ["1/12 mass of C-12", "Mass of H", "Mass of Neutron", "1 g"] },
        
            // ==================================================================
            // 8. ALPHA AND BETA DECAY - 25 Questions
            // ==================================================================
            { q: "Symbol for Alpha particle?", a: "4/2 He", opts: ["4/2 He", "0/-1 e", "0/0 y", "1/1 H"] },
            { q: "Symbol for Beta particle?", a: "0/-1 e", opts: ["0/-1 e", "4/2 He", "1/0 n", "0/0 y"] },
            { q: "Symbol for Gamma ray?", a: "0/0 Œ≥", opts: ["0/0 Œ≥", "4/2 He", "0/-1 e", "1/1 p"] },
            { q: "Alpha decay changes mass by...", a: "-4", opts: ["-4", "0", "+4", "-2"] },
            { q: "Alpha decay changes Z by...", a: "-2", opts: ["-2", "-4", "+1", "0"] },
            { q: "Beta decay changes mass by...", a: "0", opts: ["0", "-4", "+1", "-1"] },
            { q: "Beta decay changes Z by...", a: "+1", opts: ["+1", "-1", "-2", "0"] },
            { q: "Most penetrating radiation?", a: "Gamma", opts: ["Gamma", "Beta", "Alpha", "X-ray"] },
            { q: "Least penetrating radiation?", a: "Alpha", opts: ["Alpha", "Beta", "Gamma", "UV"] },
            { q: "Stopped by paper/skin?", a: "Alpha", opts: ["Alpha", "Beta", "Gamma", "Neutron"] },
            { q: "Stopped by aluminum foil?", a: "Beta", opts: ["Beta", "Alpha", "Gamma", "Proton"] },
            { q: "Stopped by thick lead?", a: "Gamma", opts: ["Gamma", "Alpha", "Beta", "Positron"] },
            { q: "Beta particle is essentially a...", a: "Electron", opts: ["Electron", "Helium Nucleus", "Photon", "Neutron"] },
            { q: "Alpha particle is essentially a...", a: "Helium Nucleus", opts: ["Helium Nucleus", "Electron", "Photon", "Proton"] },
            { q: "Gamma ray is essentially...", a: "Energy", opts: ["Energy", "Matter", "Electron", "Proton"] },
            { q: "U-238 emits Alpha. New Element?", a: "Th-234", opts: ["Th-234", "U-234", "Pu-242", "Pa-239"] },
            { q: "C-14 emits Beta. New Element?", a: "N-14", opts: ["N-14", "C-13", "B-14", "O-14"] },
            { q: "During Beta decay, neutron turns to...", a: "Proton + Electron", opts: ["Proton + Electron", "Alpha", "Gamma", "Nothing"] },
            { q: "Positron symbol?", a: "0/+1 e", opts: ["0/+1 e", "0/-1 e", "4/2 He", "1/0 n"] },
            { q: "Conservation law in nuclear eq?", a: "Mass # & Charge", opts: ["Mass # & Charge", "Only Mass", "Only Charge", "Energy"] },
            { q: "Half-life represents...", a: "Time for 50% decay", opts: ["Time for 50% decay", "Total life", "Avg life", "Decay speed"] },
            { q: "Ra-226 alpha decay produces...", a: "Rn-222", opts: ["Rn-222", "Fr-226", "Ac-226", "Ra-222"] },
            { q: "I-131 beta decay produces...", a: "Xe-131", opts: ["Xe-131", "Te-131", "I-130", "Sb-127"] },
            { q: "Nuclear Fission is...", a: "Splitting Nuclei", opts: ["Splitting Nuclei", "Combining Nuclei", "Electron loss", "Oxidation"] },
            { q: "Nuclear Fusion is...", a: "Combining Nuclei", opts: ["Combining Nuclei", "Splitting Nuclei", "Decay", "Burning"] },
        
            // ==================================================================
            // 9. MORE RULES (Aufbau, Hund, Heisenberg) - 25 Questions
            // ==================================================================
            { q: "Electrons fill lowest energy first?", a: "Aufbau Principle", opts: ["Aufbau Principle", "Hund's Rule", "Pauli Exclusion", "Octet Rule"] },
            { q: "One e- per orbital before pairing?", a: "Hund's Rule", opts: ["Hund's Rule", "Aufbau Principle", "Pauli Exclusion", "Bohr Model"] },
            { q: "Impossible to know pos & speed?", a: "Heisenberg Uncertainty", opts: ["Heisenberg Uncertainty", "Schrodinger Eq", "Planck's Law", "Bohr's Law"] },
            { q: "No two e- have same 4 quantum #'s?", a: "Pauli Exclusion", opts: ["Pauli Exclusion", "Hund's Rule", "Aufbau", "Octet"] },
            { q: "Atoms want 8 valence electrons?", a: "Octet Rule", opts: ["Octet Rule", "Duet Rule", "Aufbau", "Hund"] },
            { q: "Exception to Octet rule (needs 2)?", a: "Hydrogen", opts: ["Hydrogen", "Carbon", "Oxygen", "Neon"] },
            { q: "Shape of 's' orbital?", a: "Sphere", opts: ["Sphere", "Dumbbell", "Clover", "Complex"] },
            { q: "Shape of 'p' orbital?", a: "Dumbbell", opts: ["Dumbbell", "Sphere", "Clover", "Donut"] },
            { q: "Shape of 'd' orbital?", a: "Clover", opts: ["Clover", "Sphere", "Dumbbell", "Line"] },
            { q: "Max electrons in 's' subshell?", a: "2", opts: ["2", "6", "10", "14"] },
            { q: "Max electrons in 'p' subshell?", a: "6", opts: ["6", "2", "10", "14"] },
            { q: "Max electrons in 'd' subshell?", a: "10", opts: ["10", "6", "2", "14"] },
            { q: "Max electrons in 'f' subshell?", a: "14", opts: ["14", "10", "6", "2"] },
            { q: "Principal Quantum Number symbol?", a: "n", opts: ["n", "l", "ml", "ms"] },
            { q: "Electron Configuration for He?", a: "1s2", opts: ["1s2", "1s1", "2s2", "1p2"] },
            { q: "Valence e- in 1s2 2s2 2p5?", a: "7", opts: ["7", "5", "2", "9"] },
            { q: "Outer shell for Period 3?", a: "n=3", opts: ["n=3", "n=2", "n=1", "n=4"] },
            { q: "Cr and Cu are exceptions to...", a: "Aufbau Principle", opts: ["Aufbau Principle", "Pauli Exclusion", "Hund", "Octet"] },
            { q: "Noble Gas notation uses...", a: "Previous Noble Gas", opts: ["Previous Noble Gas", "Next Noble Gas", "First Element", "Halogen"] },
            { q: "Spin quantum number values?", a: "+1/2, -1/2", opts: ["+1/2, -1/2", "0, 1", "1, 2", "Pos, Neg"] },
            { q: "Total orbitals in p-sublevel?", a: "3", opts: ["3", "1", "5", "7"] },
            { q: "Total orbitals in d-sublevel?", a: "5", opts: ["5", "3", "1", "7"] },
            { q: "Lewis structures show...", a: "Valence Electrons", opts: ["Valence Electrons", "All Electrons", "Protons", "Neutrons"] },
            { q: "Ground state means...", a: "Lowest Energy", opts: ["Lowest Energy", "Highest Energy", "Excited", "Unstable"] },
            { q: "Excited state means...", a: "Higher Energy Level", opts: ["Higher Energy Level", "Ground State", "Nucleus", "Bonding"] },
        
            // ==================================================================
            // 10. HISTORY OF PERIODIC TABLE & MODELS - 25 Questions
            // ==================================================================
            { q: "Solid Sphere Model proposed by...", a: "Dalton", opts: ["Dalton", "Thomson", "Rutherford", "Bohr"] },
            { q: "Plum Pudding Model proposed by...", a: "Thomson", opts: ["Thomson", "Dalton", "Rutherford", "Chadwick"] },
            { q: "Nuclear Model proposed by...", a: "Rutherford", opts: ["Rutherford", "Thomson", "Bohr", "Schrodinger"] },
            { q: "Planetary Model proposed by...", a: "Bohr", opts: ["Bohr", "Rutherford", "Dalton", "Heisenberg"] },
            { q: "Quantum Mechanical Model by...", a: "Schrodinger", opts: ["Schrodinger", "Bohr", "Newton", "Mendeleev"] },
            { q: "Discovered the Electron?", a: "Thomson", opts: ["Thomson", "Rutherford", "Millikan", "Chadwick"] },
            { q: "Discovered the Nucleus?", a: "Rutherford", opts: ["Rutherford", "Thomson", "Bohr", "Curie"] },
            { q: "Discovered the Neutron?", a: "Chadwick", opts: ["Chadwick", "Rutherford", "Thomson", "Goldstein"] },
            { q: "Experiment: Gold Foil?", a: "Rutherford", opts: ["Rutherford", "Thomson", "Millikan", "Bohr"] },
            { q: "Experiment: Cathode Ray Tube?", a: "Thomson", opts: ["Thomson", "Rutherford", "Dalton", "Millikan"] },
            { q: "Experiment: Oil Drop?", a: "Millikan", opts: ["Millikan", "Thomson", "Rutherford", "Einstein"] },
            { q: "Father of Periodic Table?", a: "Mendeleev", opts: ["Mendeleev", "Moseley", "Newlands", "Lavoisier"] },
            { q: "Mendeleev ordered table by...", a: "Atomic Mass", opts: ["Atomic Mass", "Atomic Number", "Density", "Date"] },
            { q: "Modern table ordered by...", a: "Atomic Number", opts: ["Atomic Number", "Atomic Mass", "Size", "Alpha"] },
            { q: "Who reordered table by Atomic #?", a: "Moseley", opts: ["Moseley", "Mendeleev", "Seaborg", "Curie"] },
            { q: "Law of Octaves proposed by...", a: "Newlands", opts: ["Newlands", "Mendeleev", "Meyer", "Dobereiner"] },
            { q: "Concept of 'Triads'?", a: "Dobereiner", opts: ["Dobereiner", "Newlands", "Moseley", "Bohr"] },
            { q: "Ancient concept of 4 elements?", a: "Aristotle", opts: ["Aristotle", "Democritus", "Dalton", "Plato"] },
            { q: "First proposed 'Atomos'?", a: "Democritus", opts: ["Democritus", "Aristotle", "Dalton", "Newton"] },
            { q: "Bohr model works best for...", a: "Hydrogen", opts: ["Hydrogen", "Gold", "Uranium", "Multi-electron"] },
            { q: "Rutherford proved atom is mostly...", a: "Empty Space", opts: ["Empty Space", "Solid", "Positive", "Negative"] },
            { q: "Mendeleev predicted properties of...", a: "Undiscovered Elements", opts: ["Undiscovered Elements", "Electrons", "Protons", "Isotopes"] },
            { q: "Discovered Polonium & Radium?", a: "Marie Curie", opts: ["Marie Curie", "Mendeleev", "Rutherford", "Becquerel"] },
            { q: "Actinide series moved by...", a: "Seaborg", opts: ["Seaborg", "Mendeleev", "Moseley", "Pauling"] },
            { q: "Wave-Particle Duality?", a: "De Broglie", opts: ["De Broglie", "Bohr", "Newton", "Dalton"] }
        ];
                
        const orbitalKeys = ["1s", "2s", "2p", "3s", "3p", "4s", "3d", "4p", "5s", "4d", "5p"];
        const nobleGases = [{z:2,s:"He"},{z:10,s:"Ne"},{z:18,s:"Ar"},{z:36,s:"Kr"},{z:54,s:"Xe"}];

        let state = {
            element: null,
            targetCategory: null,
            vocabQ: null,
            mode: 'build_normal',
            gameType: 'Classic', 
            streak: 0,
            score: 0,
            level: 1,
            userParts: [],
            userNum: "",
            diagram: [],
            waitingNext: false,
            
            // Mode Specifics
            isotopeNeutrons: 0,
            isotopeMass: 0,
            isotopeCharge: 0,
            particleType: 'n',
            sigFigProblem: null,
            trendQ: null,
            metricQ: null, 
            sciNotQ: null, 

            // Settings
            timerEnabled: false,
            timerDuration: 30,
            timeLeft: 30,
            timerId: null,
            periodLimit: 5,
            difficulty: 'normal'
        };

        const huntCategories = {
            alkali: { name: "Alkali Metal", z: [3, 11, 19, 37] },
            alkaline: { name: "Alkaline Earth", z: [4, 12, 20, 38] },
            halogen: { name: "Halogen", z: [9, 17, 35, 53] },
            noble: { name: "Noble Gas", z: [2, 10, 18, 36, 54] },
            transition: { name: "Transition Metal", z: [21,22,23,24,25,26,27,28,29,30,39,40,41,42,43,44,45,46,47,48] },
            metalloid: { name: "Metalloid", z: [5, 14, 32, 33, 51, 52] }
        };

        // --- NEW GENERATORS ---
        function generateMetric() {
            const units = ['m', 'g', 'L'];
            const prefixes = [
                {p:'k', v:1000}, {p:'', v:1}, {p:'c', v:0.01}, {p:'m', v:0.001}
            ];
            const baseVal = Math.floor(Math.random() * 500) + 1;
            const u = units[Math.floor(Math.random() * units.length)];
            const from = prefixes[Math.floor(Math.random() * prefixes.length)];
            let to = prefixes[Math.floor(Math.random() * prefixes.length)];
            while(from === to) to = prefixes[Math.floor(Math.random() * prefixes.length)];

            const ansVal = (baseVal * from.v) / to.v;
            // Format answer to avoid floating point ugliness
            const ansStr = Number.isInteger(ansVal) ? ansVal : ansVal.toFixed(Math.max(1, 5 - Math.floor(Math.log10(ansVal)||0))).replace(/\.?0+$/, "");
            
            // Generate distractors
            const wrong1 = ansVal * 10;
            const wrong2 = ansVal / 10;
            const wrong3 = ansVal * 100;
            
            const opts = [ansStr + " " + to.p + u, wrong1 + " " + to.p + u, wrong2 + " " + to.p + u, wrong3 + " " + to.p + u];
            return { q: `${baseVal} ${from.p}${u} = ? ${to.p}${u}`, a: ansStr + " " + to.p + u, opts: opts.sort(()=>Math.random()-0.5) };
        }

        function generateSciNot() {
            const base = (Math.random() * 9 + 1).toFixed(1);
            const exp = Math.floor(Math.random() * 10) - 5; // -5 to 4
            const val = base * Math.pow(10, exp);
            
            // Display normal number, ask for Sci Not
            let displayNum = val.toString();
            if(Math.abs(exp) > 3) displayNum = val.toExponential(); // Fallback if JS auto-converts
            else displayNum = val.toFixed(Math.max(0, -exp + 1));
            
            // If random is "reverse", show Sci Not ask for Standard
            const reverse = Math.random() > 0.5;
            
            const correctSci = `${base} √ó 10^${exp}`;
            const correctStd = val.toFixed(Math.max(0, -exp + 1)).replace(/\.?0+$/, "");
            
            const q = reverse ? correctSci : displayNum;
            const a = reverse ? correctStd : correctSci;
            
            // Distractors
            const wExp = exp + 1;
            const wBase = (parseFloat(base) + 1).toFixed(1);
            
            let opts = [];
            if(reverse) {
                opts = [a, (val*10).toString(), (val/10).toString(), (val*2).toString()];
            } else {
                opts = [a, `${base} √ó 10^${wExp}`, `${wBase} √ó 10^${exp}`, `${base} √ó 10^${-exp}`];
            }
            
            return { q: q, a: a, opts: opts.sort(()=>Math.random()-0.5) };
        }

        function generateSigFig() {
            const types = ['decimal', 'integer', 'sci'];
            const type = types[Math.floor(Math.random() * types.length)];
            let numStr = "";
            let count = 0;

            if(type === 'decimal') {
                const base = (Math.random() * 100).toFixed(Math.floor(Math.random() * 4) + 1);
                numStr = base;
                if(parseFloat(base) < 1) {
                    const match = base.match(/^0\.0*([1-9]\d*)/);
                    count = match ? match[1].length : 0;
                } else {
                    count = base.replace('.', '').length;
                }
            } else if (type === 'integer') {
                const base = Math.floor(Math.random() * 9000) + 100;
                const zeros = Math.floor(Math.random() * 3);
                numStr = base + "0".repeat(zeros);
                count = String(base).length; 
                if(Math.random() > 0.5) {
                    numStr += ".";
                    count += zeros;
                }
            } else {
                const coef = (Math.random() * 9 + 1).toFixed(2);
                const exp = Math.floor(Math.random() * 10);
                numStr = `${coef} x 10^${exp}`;
                count = 3;
            }
            return { q: numStr, a: count };
        }

        // --- DASHBOARD ---
        function toggleTimerSettings() { state.timerEnabled = document.getElementById('timer-toggle').checked; document.getElementById('timer-duration-setting').classList.toggle('opacity-50', !state.timerEnabled); }
        function setTimerDuration(sec) { state.timerDuration = sec; [15,30,60].forEach(s => { const btn = document.getElementById(`t-${s}`); if(s===sec){btn.classList.add('bg-blue-600','text-white');btn.classList.remove('bg-slate-50');}else{btn.classList.remove('bg-blue-600','text-white');btn.classList.add('bg-slate-50');} }); }
        function setFocusRange(limit) { state.periodLimit = limit; [3,4,5].forEach(l => { const btn = document.getElementById(`range-${l}`); if(l===limit){btn.classList.add('bg-blue-600','text-white');btn.classList.remove('bg-slate-50');}else{btn.classList.remove('bg-blue-600','text-white');btn.classList.add('bg-slate-50');} }); }
        function setDifficulty(level) {
            state.difficulty = level;
            ['normal', 'pro', 'ultra'].forEach(l => {
                const btn = document.getElementById(`diff-${l}`);
                if(l === level) { btn.classList.remove('bg-slate-50','text-slate-500'); btn.classList.add('bg-purple-600','text-white','border-purple-600'); }
                else { btn.classList.add('bg-slate-50','text-slate-500'); btn.classList.remove('bg-purple-600','text-white','border-purple-600'); }
            });
            const desc = document.getElementById('diff-desc');
            if(level === 'normal') desc.innerText = "Standard experience with all hints enabled.";
            else if(level === 'pro') desc.innerText = "Hints disabled. Test your memory.";
            else desc.innerText = "Hardcore: No hints + Atomic numbers hidden.";
            renderPTable();
        }

        function showDashboard() {
            clearInterval(state.timerId);
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('dashboard').classList.add('flex');
        }

        function switchDash(section) {
            document.querySelectorAll('.dash-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.dash-nav-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(`dash-${section}`).classList.add('active');
            document.getElementById(`nav-${section}`).classList.add('active');
        }

        function startGame(type) {
            state.gameType = type; state.score = 0; state.streak = 0; state.level = 1; updateStats();
            document.getElementById('dashboard').classList.add('hidden'); document.getElementById('dashboard').classList.remove('flex'); nextLevel();
        }

        function startTimer() {
            clearInterval(state.timerId);
            if(!state.timerEnabled) { document.getElementById('timer-bar-container').classList.add('hidden'); return; }
            document.getElementById('timer-bar-container').classList.remove('hidden');
            const bar = document.getElementById('timer-bar'); state.timeLeft = state.timerDuration;
            bar.style.transition = 'none'; bar.style.width = '100%'; void bar.offsetWidth;
            bar.style.transition = `width ${state.timerDuration}s linear`; bar.style.width = '0%';
            state.timerId = setInterval(() => { state.timeLeft--; if(state.timeLeft <= 0) { clearInterval(state.timerId); revealAnswer("Time's Up!"); } }, 1000);
        }

        // --- Core ---
        function getCorrectConfig(z, mode) { /* Logic Unchanged */ let electrons=z; let parts=[]; let noble=null; let isShort=mode.includes('short')||mode==='identify_config'; if(isShort) for(let i=nobleGases.length-1;i>=0;i--){if(nobleGases[i].z<z){noble=nobleGases[i];electrons-=noble.z;break;}} let order=[{n:"1s",max:2},{n:"2s",max:2},{n:"2p",max:6},{n:"3s",max:2},{n:"3p",max:6},{n:"4s",max:2},{n:"3d",max:10},{n:"4p",max:6},{n:"5s",max:2},{n:"4d",max:10},{n:"5p",max:6}]; if(noble){if(noble.s==='He')order=order.slice(1);if(noble.s==='Ne')order=order.slice(3);if(noble.s==='Ar')order=order.slice(5);if(noble.s==='Kr')order=order.slice(8);} for(let orb of order){ if(electrons<=0)break; let fill=Math.min(electrons,orb.max); if((z===24||z===29||z===47)&&orb.n.endsWith('s')&&electrons>=orb.max)fill=1; if((z===24)&&orb.n==='3d'&&fill===4)fill=5; if((z===29||z===47)&&orb.n.endsWith('d')&&fill===9)fill=10; if(z===46){if(orb.n==='5s')fill=0;if(orb.n==='4d')fill=10;} if(fill>0)parts.push({label:orb.n,count:fill});electrons-=fill; } return {noble:noble?`[${noble.s}]`:null,parts}; }

        function renderPTable() {
            const container = document.getElementById('ptable-container'); container.innerHTML = '';
            const gridMap={}; elements.forEach(e=>{
                let r,c; 
                if(e.z===1){r=1;c=1;}else if(e.z===2){r=1;c=18;}
                else if(e.z<=10){r=2;c=e.z<=4?e.z-2:e.z+8;}
                else if(e.z<=18){r=3;c=e.z<=12?e.z-10:e.z;}
                else if(e.z<=36){r=4;c=e.z-18;}else if(e.z<=54){r=5;c=e.z-36;}
                gridMap[`${r}-${c}`]=e;
            });
            for(let r=1;r<=5;r++){
                for(let c=1;c<=18;c++){
                    const el=gridMap[`${r}-${c}`]; const div=document.createElement('div');
                    if(el){
                        div.className = `element block-${el.b}`; div.id=`el-${el.z}`;
                        const numHtml = state.difficulty==='ultra'?'':`<span class="number">${el.z}</span>`;
                        div.innerHTML = `${numHtml}<span class="symbol">${el.s}</span>`;
                        div.onclick=()=>handleElementClick(el);
                    } else div.className='opacity-0 pointer-events-none';
                    container.appendChild(div);
                }
            }
        }

        function setMode() {
            ['builder-ui', 'numeric-ui', 'quiz-ui', 'diagram-ui', 'identify-hint', 'info-panel', 'trend-ui'].forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById('input-area').classList.remove('hidden'); document.getElementById('submit-wrapper').classList.remove('hidden');
            
            // Mode Logic from previous builds...
            if (state.gameType === 'Classic') {
                const modes = ['build_normal', 'identify_config', 'calc_particles', 'sig_fig', 'vocab', 'trend_faceoff', 'metric', 'scinot']; 
                state.mode = modes[Math.floor(Math.random() * modes.length)];
            } else if (state.gameType === 'Architect') state.mode = Math.random() > 0.5 ? 'build_normal' : 'build_short';
            else if (state.gameType === 'Quantum') state.mode = 'build_diagram';
            else if (state.gameType === 'Detective') { if(Math.random()<0.4) state.mode='identify_config'; else { const m=['identify_diagram','hunt_alkali','hunt_alkaline','hunt_halogen','hunt_noble','hunt_transition','hunt_metalloid']; state.mode=m[Math.floor(Math.random()*m.length)]; } }
            else if (state.gameType === 'Nuclear') state.mode = 'calc_particles';
            else if (state.gameType === 'SigFig') state.mode = 'sig_fig';
            else if (state.gameType === 'Trends') state.mode = 'trend_faceoff';
            else if (state.gameType === 'Trivia') state.mode = 'vocab';
            else if (state.gameType === 'Metric') state.mode = 'metric';
            else if (state.gameType === 'SciNot') state.mode = 'scinot';
            
            state.waitingNext = false; state.userParts = []; state.userNum = ""; state.diagram = [];
            const badge = document.getElementById('mode-badge'); const promptContent = document.getElementById('prompt-content');
            startTimer();

            // Hints
            if(state.difficulty!=='normal') { document.getElementById('diagram-hint').classList.add('hidden'); document.getElementById('hunt-msg').classList.add('hidden'); }
            else { document.getElementById('diagram-hint').classList.remove('hidden'); document.getElementById('hunt-msg').classList.remove('hidden'); }

            switch(state.mode) {
                case 'build_normal':
                case 'build_short':
                    badge.innerHTML = `<div class="w-2.5 h-2.5 rounded-full bg-blue-500"></div> Configuration`;
                    promptContent.innerHTML = `<div class="text-6xl font-black text-slate-800">${state.element.s}</div><div class="text-lg text-slate-500">${state.element.n}</div>`;
                    document.getElementById('builder-ui').classList.remove('hidden'); document.getElementById('builder-ui').classList.add('flex');
                    renderBuilder(); highlightElement(); break;

                case 'build_diagram':
                    badge.innerHTML = `<div class="w-2.5 h-2.5 rounded-full bg-orange-500"></div> Diagramming`;
                    promptContent.innerHTML = `<div class="text-6xl font-black text-slate-800">${state.element.s}</div><div class="text-lg text-slate-500">${state.element.n}</div>`;
                    document.getElementById('diagram-ui').classList.remove('hidden'); document.getElementById('diagram-ui').classList.add('flex');
                    renderDiagramInput(); highlightElement(); break;

                case 'identify_config':
                case 'identify_diagram':
                    badge.innerHTML = `<div class="w-2.5 h-2.5 rounded-full bg-pink-500"></div> Identify`;
                    document.getElementById('input-area').classList.add('hidden'); document.getElementById('identify-hint').classList.remove('hidden'); document.getElementById('identify-hint').classList.add('flex'); document.getElementById('ptable-container').classList.add('mode-identify');
                    if(state.difficulty==='normal') document.getElementById('table-instruction').classList.remove('hidden');
                    if(state.mode === 'identify_config') {
                        const sol = getCorrectConfig(state.element.z, 'short');
                        let str = (sol.noble ? sol.noble + " " : "") + sol.parts.map(p => `${p.label}<sup>${p.count}</sup>`).join(" ");
                        promptContent.innerHTML = `<div class="text-xl font-mono text-slate-700 bg-slate-100 p-4 rounded-xl shadow-inner">${str}</div>`;
                    } else {
                        promptContent.innerHTML = `<div id="diagram-preview" class="flex flex-wrap gap-2 justify-center p-2 rounded-xl bg-slate-50 border border-slate-100"></div>`;
                        renderDiagramPreview(state.element.z);
                    }
                    break;

                case 'vocab':
                    badge.innerHTML = `<div class="w-2.5 h-2.5 rounded-full bg-yellow-500"></div> Terminology`;
                    state.vocabQ = vocabBank[Math.floor(Math.random() * vocabBank.length)];
                    promptContent.innerHTML = `<div class="text-lg font-bold text-slate-700 p-2">${state.vocabQ.q}</div>`;
                    document.getElementById('quiz-ui').classList.remove('hidden'); document.getElementById('submit-wrapper').classList.add('hidden');
                    renderVocabQuiz(); break;

                case 'calc_particles':
                    badge.innerHTML = `<div class="w-2.5 h-2.5 rounded-full bg-indigo-500"></div> Particles`;
                    state.isotopeNeutrons = (state.element.z <= 20 ? state.element.z : Math.round(state.element.z * 1.2)) + Math.floor(Math.random() * 4);
                    state.isotopeMass = state.element.z + state.isotopeNeutrons;
                    if([2,10,18,36,54].includes(state.element.z)) state.isotopeCharge = 0; else state.isotopeCharge = Math.floor(Math.random() * 6) - 2; 
                    state.particleType = ['p', 'n', 'e'][Math.floor(Math.random() * 3)];
                    const chargeStr = state.isotopeCharge === 0 ? '' : (state.isotopeCharge > 0 ? `+${state.isotopeCharge}` : state.isotopeCharge);
                    promptContent.innerHTML = `<div class="relative inline-block text-center mb-2"><span class="absolute -top-2 -left-4 text-xs font-bold text-slate-500">${state.isotopeMass}</span><span class="absolute -top-2 -right-4 text-xs font-bold text-blue-500">${chargeStr}</span><div class="text-6xl font-black text-slate-800">${state.element.s}</div></div><p class="text-sm font-bold text-slate-600">Find Number of ${state.particleType === 'p' ? 'PROTONS' : state.particleType === 'n' ? 'NEUTRONS' : 'ELECTRONS'}</p>`;
                    document.getElementById('numeric-ui').classList.remove('hidden'); renderNumericKeys(); break;
                
                case 'count_valence':
                    while(state.element.v === null) state.element = elements[Math.floor(Math.random() * elements.length)];
                    badge.innerHTML = `<div class="w-2.5 h-2.5 rounded-full bg-teal-500"></div> Valence`;
                    promptContent.innerHTML = `<div class="text-6xl font-black text-slate-800 mb-1">${state.element.s}</div><div class="text-lg text-slate-500">${state.element.n}</div>`;
                    document.getElementById('numeric-ui').classList.remove('hidden'); renderNumericKeys(); break;
                
                case 'calc_neutrons':
                    // Legacy catch
                    state.mode='calc_particles'; setMode(); return;

                case 'metric':
                    badge.innerHTML = `<div class="w-2.5 h-2.5 rounded-full bg-green-500"></div> Metric`;
                    state.metricQ = generateMetric();
                    promptContent.innerHTML = `<div class="text-3xl font-mono font-bold text-slate-700">${state.metricQ.q}</div>`;
                    document.getElementById('quiz-ui').classList.remove('hidden'); document.getElementById('submit-wrapper').classList.add('hidden');
                    renderMetricQuiz(); break;
                
                case 'scinot':
                    badge.innerHTML = `<div class="w-2.5 h-2.5 rounded-full bg-indigo-500"></div> Sci-Not`;
                    state.sciNotQ = generateSciNot();
                    promptContent.innerHTML = `<div class="text-3xl font-mono font-bold text-slate-700">${state.sciNotQ.q}</div>`;
                    document.getElementById('quiz-ui').classList.remove('hidden'); document.getElementById('submit-wrapper').classList.add('hidden');
                    renderSciNotQuiz(); break;

                case 'sig_fig':
                    badge.innerHTML = `<div class="w-2.5 h-2.5 rounded-full bg-teal-500"></div> Measurements`;
                    state.sigFigProblem = generateSigFig();
                    promptContent.innerHTML = `<div class="text-4xl font-mono font-bold text-slate-700 bg-slate-100 px-4 py-2 rounded-lg border border-slate-200">${state.sigFigProblem.q}</div><p class="mt-4 text-xs font-bold text-slate-400 uppercase tracking-widest">Count Significant Figures</p>`;
                    document.getElementById('numeric-ui').classList.remove('hidden'); renderNumericKeys(); break;

                case 'trend_faceoff':
                    badge.innerHTML = `<div class="w-2.5 h-2.5 rounded-full bg-purple-500"></div> Face-Off`;
                    let e1 = state.element;
                    let e2 = elements[Math.floor(Math.random() * elements.length)];
                    while(e1.z === e2.z) e2 = elements[Math.floor(Math.random() * elements.length)];
                    
                    const trendTypes = ['Radius', 'Electronegativity', 'Ionization Energy', 'Electron Affinity'];
                    const tType = trendTypes[Math.floor(Math.random() * 4)];
                    
                    state.trendQ = { e1, e2, type: tType };
                    
                    promptContent.innerHTML = `<p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">Which is HIGHER?</p><div class="text-2xl font-black text-slate-800">${tType}</div>`;
                    const trendUI = document.getElementById('trend-ui'); trendUI.innerHTML = '';
                    [e1, e2].forEach(e => {
                        const btn = document.createElement('button');
                        btn.className = "flex-1 aspect-square bg-slate-50 border-2 border-slate-200 rounded-2xl flex flex-col items-center justify-center hover:border-blue-500 hover:bg-blue-50 transition-all group";
                        btn.innerHTML = `<span class="text-3xl font-black text-slate-700 group-hover:text-blue-600">${e.s}</span><span class="text-xs text-slate-400 font-bold">${e.n}</span>`;
                        btn.onclick = () => checkTrend(e);
                        trendUI.appendChild(btn);
                    });
                    trendUI.classList.remove('hidden'); trendUI.classList.add('flex');
                    document.getElementById('submit-wrapper').classList.add('hidden');
                    break;
            }
            
            // Hunt Mode
            if(state.mode.startsWith('hunt')) {
                const t = state.mode.split('_')[1];
                state.targetCategory = huntCategories[t];
                
                document.getElementById('input-area').classList.add('hidden');
                document.getElementById('identify-hint').classList.remove('hidden');
                document.getElementById('identify-hint').classList.add('flex');
                document.getElementById('ptable-container').classList.add('mode-identify');
                if(state.difficulty === 'normal') document.getElementById('table-instruction').classList.remove('hidden');
                
                badge.innerHTML = `<div class="w-2.5 h-2.5 rounded-full bg-emerald-500"></div> Hunt`;
                if(state.difficulty === 'normal') document.getElementById('hunt-msg').innerHTML = `Find any <b>${state.targetCategory.name}</b>.`;
                promptContent.innerHTML = `<div class="fade-in text-center flex flex-col items-center justify-center h-[80px]"><div class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">FIND A</div><div class="text-2xl font-black text-slate-800 tracking-tight leading-none">${state.targetCategory.name}</div></div>`;
            }
        }

        // --- HANDLERS ---
        function checkTrend(selected) {
            if(state.waitingNext) return;
            const { e1, e2, type } = state.trendQ;
            let winner;
            const getPos = (e) => {
                let r,c; 
                if(e.z<=2){r=1;c=e.z===1?1:18;} 
                else if(e.z<=10){r=2;c=e.z<=4?e.z-2:e.z+8;} 
                else if(e.z<=18){r=3;c=e.z<=12?e.z-10:e.z;} 
                else if(e.z<=36){r=4;c=e.z-18;} else {r=5;c=e.z-36;}
                return {r,c};
            };
            const p1=getPos(e1); const p2=getPos(e2);

            // Radius: Increases Left & Down
            if (type === 'Radius') {
                if (p1.r > p2.r) winner = e1; else if (p2.r > p1.r) winner = e2;
                else winner = p1.c < p2.c ? e1 : e2;
            } else {
                // IE, EN, Affinity: Increase Right & Up
                if (p1.r < p2.r) winner = e1; else if (p2.r < p1.r) winner = e2;
                else winner = p1.c > p2.c ? e1 : e2;
            }

            if (selected === winner) success();
            else fail(`Wrong! ${type} increases ${type==='Radius'?'Down/Left':'Up/Right'}.`);
        }

        function highlightElement() {
            if(state.difficulty !== 'normal') return; 
            const el = document.getElementById(`el-${state.element.z}`);
            if(el) { el.classList.add('target-highlight'); el.scrollIntoView({behavior:'smooth', block:'center', inline:'center'}); }
        }
        // ... (Renderers for Builder, Numeric, Vocab, Diagram - Same as before) ...
        function renderBuilder() {
            const out = document.getElementById('config-output'); const keypad = document.getElementById('orbital-keypad');
            out.innerHTML = state.userParts.length ? '' : '<span class="text-slate-400 text-xs italic">Assemble the configuration here...</span>'; keypad.innerHTML = '';
            if (state.mode === 'build_short') { ["[He]", "[Ne]", "[Ar]", "[Kr]"].forEach(n => { const b = document.createElement('button'); b.className = "key-btn key-noble text-xs"; b.innerText = n; b.onclick = () => addConfigPart(n, true); keypad.appendChild(b); }); }
            orbitalKeys.forEach(k => { const b = document.createElement('button'); b.className = "key-btn text-xs"; b.innerText = k; b.onclick = () => addConfigPart(k, false); keypad.appendChild(b); });
        }
        function addConfigPart(label, isNoble) {
            if(state.waitingNext) return;
            if(isNoble) { state.userParts = state.userParts.filter(p => !p.isNoble); state.userParts.unshift({label, isNoble:true}); } 
            else {
                const max = label.charAt(1)==='s'?2:label.charAt(1)==='p'?6:10;
                const exist = state.userParts.find(p => p.label === label);
                if(exist) exist.count = (exist.count % max) + 1; else state.userParts.push({label, count:1, isNoble:false});
            }
            updateConfigDisplay();
        }
        function updateConfigDisplay() {
            const out = document.getElementById('config-output'); out.innerHTML = '';
            state.userParts.forEach((p, i) => {
                const div = document.createElement('div'); div.className = "config-block fade-in" + (p.isNoble ? " bg-slate-800 text-white border-slate-900" : "");
                div.innerHTML = `<span class="font-mono font-bold">${p.label}</span>${!p.isNoble?`<span class="config-super">${p.count}</span>`:''}`;
                div.onclick = () => { state.userParts.splice(i, 1); updateConfigDisplay(); }; out.appendChild(div);
            });
        }
        function renderNumericKeys() {
            const keypad = document.getElementById('numeric-keys'); keypad.innerHTML = ''; document.getElementById('numeric-display').innerText = "";
            [1,2,3,4,5,6,7,8,9,0].forEach(n => {
                const b = document.createElement('button'); b.className = "key-btn text-xl"; b.innerText = n;
                b.onclick = () => { if(state.userNum.length < 3) { state.userNum += n; document.getElementById('numeric-display').innerText = state.userNum; } }; keypad.appendChild(b);
            });
            const del = document.createElement('button'); del.className = "key-btn text-red-500"; del.innerText = "‚å´";
            del.onclick = () => { state.userNum = state.userNum.slice(0, -1); document.getElementById('numeric-display').innerText = state.userNum; }; keypad.appendChild(del);
        }
        function renderVocabQuiz() {
            const ui = document.getElementById('quiz-ui'); ui.innerHTML = '';
            state.vocabQ.opts.forEach(opt => {
                const b = document.createElement('button'); b.className = "key-btn p-4 text-sm mb-1"; b.innerText = opt;
                b.onclick = () => { if(opt === state.vocabQ.a) success(); else fail("Wrong Term!"); }; ui.appendChild(b);
            });
        }
        function renderMetricQuiz() {
            const ui = document.getElementById('quiz-ui'); ui.innerHTML = '';
            state.metricQ.opts.forEach(opt => {
                const b = document.createElement('button'); b.className = "key-btn p-4 text-sm mb-1"; b.innerText = opt;
                b.onclick = () => { if(opt === state.metricQ.a) success(); else fail("Wrong Unit!"); }; ui.appendChild(b);
            });
        }
        function renderSciNotQuiz() {
            const ui = document.getElementById('quiz-ui'); ui.innerHTML = '';
            state.sciNotQ.opts.forEach(opt => {
                const b = document.createElement('button'); b.className = "key-btn p-4 text-sm mb-1 font-mono"; b.innerText = opt;
                b.onclick = () => { if(opt === state.sciNotQ.a) success(); else fail("Check Exponent!"); }; ui.appendChild(b);
            });
        }
        function renderDiagramInput() {
            const grid = document.getElementById('orbital-diagram-grid'); grid.innerHTML = '';
            const order = [ {n:"1s",c:1}, {n:"2s",c:1}, {n:"2p",c:3}, {n:"3s",c:1}, {n:"3p",c:3}, {n:"4s",c:1}, {n:"3d",c:5}, {n:"4p",c:3}, {n:"5s",c:1}, {n:"4d",c:5}, {n:"5p",c:3} ];
            state.diagram = [];
            const lastPart = getCorrectConfig(state.element.z, 'normal').parts.slice(-1)[0];
            const limit = orbitalKeys.indexOf(lastPart.label);
            order.forEach(grp => {
                if(orbitalKeys.indexOf(grp.n) > limit) return;
                const grpDiv = document.createElement('div'); grpDiv.className = "flex flex-col items-center mx-1 mb-2";
                grpDiv.innerHTML = `<span class="text-[10px] font-bold text-slate-400 mb-1 uppercase">${grp.n}</span>`;
                const row = document.createElement('div'); row.className = "flex gap-0.5 sm:gap-1";
                for(let i=0; i<grp.c; i++) {
                    const box = document.createElement('div'); box.className = "orbital-box"; const bObj = { count: 0 }; state.diagram.push(bObj);
                    box.onclick = () => { if(bObj.count===0) bObj.count=2; else if(bObj.count===2) bObj.count=1; else bObj.count=0; box.innerHTML = ''; if(bObj.count>=1) box.innerHTML += '<span class="spin-arrow text-blue-500 relative -top-0.5">‚Üë</span>'; if(bObj.count===2) box.innerHTML += '<span class="spin-arrow text-red-500 relative top-0.5">‚Üì</span>'; };
                    row.appendChild(box);
                }
                grpDiv.appendChild(row); grid.appendChild(grpDiv);
            });
        }
        function renderDiagramPreview(z) {
            const container = document.getElementById('diagram-preview'); container.innerHTML = '';
            const order = [ {n:"1s",c:1}, {n:"2s",c:1}, {n:"2p",c:3}, {n:"3s",c:1}, {n:"3p",c:3}, {n:"4s",c:1}, {n:"3d",c:5}, {n:"4p",c:3}, {n:"5s",c:1}, {n:"4d",c:5}, {n:"5p",c:3} ];
            let electrons = z;
            order.forEach(grp => {
                if(electrons <= 0) return;
                const grpDiv = document.createElement('div'); grpDiv.className = "flex flex-col items-center mx-0.5";
                grpDiv.innerHTML = `<span class="text-[8px] font-bold text-slate-300 mb-0.5">${grp.n}</span>`;
                const row = document.createElement('div'); row.className = "flex gap-0.5";
                for(let i=0; i<grp.c; i++) {
                    const box = document.createElement('div'); box.className = "w-5 h-5 sm:w-6 sm:h-6 border border-slate-300 rounded flex justify-center items-center bg-white";
                    let count = 0;
                    if(electrons>0) { count++; electrons--; }
                    if(electrons>0 && (z<=20 ? electrons >= (grp.c - i) : electrons >= (grp.c - i))) { if(electrons >= (grp.c - i)) { count++; electrons--; } }
                    if(count>=1) box.innerHTML += '<span class="text-blue-500 text-[10px] sm:text-xs">‚Üë</span>'; if(count===2) box.innerHTML += '<span class="text-red-500 text-[10px] sm:text-xs">‚Üì</span>';
                    row.appendChild(box);
                }
                grpDiv.appendChild(row); container.appendChild(grpDiv);
            });
        }

        function handleElementClick(el) {
            if(state.waitingNext) return;
            if(!state.mode.startsWith('identify') && !state.mode.startsWith('hunt')) return;
            let correct = false;
            if(state.mode.startsWith('hunt')) { if(state.targetCategory.z.includes(el.z)) { correct = true; state.element = el; } } 
            else { if(el.z === state.element.z) correct = true; }
            if(correct) success(); else fail("Wrong Element!");
        }

        document.getElementById('submit-btn').onclick = () => {
            if(state.waitingNext) return;
            let correct = false;
            if(state.mode === 'calc_particles') {
                const target = state.particleType === 'p' ? state.element.z : state.particleType === 'n' ? state.isotopeNeutrons : (state.element.z - state.isotopeCharge);
                if(parseInt(state.userNum) === target) correct = true;
            } else if (state.mode === 'sig_fig') {
                if(state.userNum == state.sigFigProblem.a) correct = true;
            } else if (state.mode === 'count_valence') {
                if(parseInt(state.userNum) === state.element.v) correct = true;
            } else if (state.mode.startsWith('build')) {
                let sol = getCorrectConfig(state.element.z, state.mode);
                // Simple validation for config
                if(state.mode === 'build_diagram') correct = state.diagram.reduce((a,b)=>a+b.count,0)===state.element.z; 
                else {
                    let userStr = state.userParts.map(p => p.isNoble?p.label:`${p.label}${p.count}`).join(" ");
                    let solStr = (sol.noble?sol.noble+" ":"") + sol.parts.map(p => `${p.label}${p.count}`).join(" ");
                    if(userStr === solStr) correct = true;
                }
            }

            if(correct) success(); else fail("Incorrect Answer!");
        };

        function success() {
            clearInterval(state.timerId); state.waitingNext = true; state.streak++; state.score += 100; updateStats(); showToast("Correct!", `Streak: ${state.streak}`, true);
            document.getElementById('input-area').classList.add('hidden'); document.getElementById('identify-hint').classList.add('hidden'); document.getElementById('trend-ui').classList.add('hidden'); document.getElementById('info-panel').classList.remove('hidden');
            if(state.mode === 'metric' || state.mode === 'scinot' || state.mode === 'vocab' || state.mode === 'sig_fig') {
                document.getElementById('info-title').innerText = "Correct!"; document.getElementById('info-desc').innerText = "Concept Mastered.";
            } else {
                document.getElementById('info-title').innerText = `${state.element.n}`; document.getElementById('info-desc').innerText = state.element.d;
            }
        }
        function fail(msg) {
            state.streak = 0; updateStats(); showToast("Incorrect", msg, false);
            const card = document.getElementById('prompt-card'); card.classList.add('shake'); setTimeout(() => card.classList.remove('shake'), 400);
        }
        function showToast(title, msg, isSuccess) {
            const t = document.getElementById('toast'); document.getElementById('toast-title').innerText = title; document.getElementById('toast-msg').innerText = msg;
            t.classList.remove('toast-hidden'); t.classList.add('toast-visible');
            setTimeout(() => { t.classList.remove('toast-visible'); t.classList.add('toast-hidden'); }, 1800);
        }
        function revealAnswer(msg) {
            clearInterval(state.timerId); state.waitingNext = true; state.streak = 0; updateStats(); showToast("Time's Up!", msg, false);
            document.getElementById('input-area').classList.add('hidden'); document.getElementById('identify-hint').classList.add('hidden'); document.getElementById('trend-ui').classList.add('hidden'); document.getElementById('info-panel').classList.remove('hidden');
            
            let title="Solution"; let desc="Time ran out.";
            if(state.mode==='vocab') desc=`Answer: ${state.vocabQ.a}`;
            else if(state.mode==='metric') desc=`Correct: ${state.metricQ.a}`;
            else if(state.mode==='scinot') desc=`Correct: ${state.sciNotQ.a}`;
            else if(state.mode==='sig_fig') desc=`Result: ${state.sigFigProblem.a}`;
            else if(state.mode==='trend_faceoff') desc=`${state.trendQ.type} follows periodic trends.`;
            else if(state.mode==='calc_particles') { const e=state.element.z-state.isotopeCharge; desc=`p+: ${state.element.z}, n0: ${state.isotopeNeutrons}, e-: ${e}`; }
            else { title=`${state.element.n}`; const config=getCorrectConfig(state.element.z, 'short'); desc=`Config: ${(config.noble?config.noble+" ":"")+config.parts.map(p=>p.label+p.count).join(" ")}`; }
            
            document.getElementById('info-title').innerText = title; document.getElementById('info-desc').innerText = desc;
        }
        function updateStats() {
            document.getElementById('streak-val').innerText = state.streak; document.getElementById('score-val').innerText = state.score; document.getElementById('level-val').innerText = state.level;
        }
        window.nextLevel = () => {
            let pool = elements; // Using full list
            if(state.periodLimit === 3) pool = elements.filter(e => e.z <= 18);
            else if(state.periodLimit === 4) pool = elements.filter(e => e.z <= 36);
            state.element = pool[Math.floor(Math.random() * pool.length)];
            setMode(); 
        };
        window.resetInput = () => {
            state.userParts = []; state.userNum = ""; document.getElementById('numeric-display').innerText = "";
            if(state.mode.startsWith('build')) updateConfigDisplay();
        };
        window.onload = () => {
            renderPTable(); setTimerDuration(30); 
        };
    </script>
</body>
</html>